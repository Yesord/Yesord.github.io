{"title":"三子棋对弈装置--视觉部分","uid":"46d63a6191ce7c7d772a0f14338f0d34","slug":"三子棋对弈装置-视觉部分","date":"2024-08-12T14:55:02.000Z","updated":"2025-02-20T07:30:15.774Z","comments":true,"path":"api/articles/三子棋对弈装置-视觉部分.json","keywords":null,"cover":"https://s2.loli.net/2024/07/22/9QG8dFxISpaDAq2.jpg","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>本篇blog是本人在打2024电赛E题学习到的相关知识的整理，由于我们选择的方案是深度数据和RGB数据融合的方法来判断棋子的位置。不同于大多数人选择的openmv作为视觉传感，所以我觉得在实现思路上会相对不那么随大流一点，当然我也会提供我自己个人的传统RGB 2DV的思路。在此，我仅会提供部分代码以供参考。</p>\n<details class=\"custom-details\">\n<summary>自我吐槽</summary>\n<p>由于当时全心全意在攒这个代码，没去做照片的记录，所以以下很多的代码没有效果图的作证会有点难受，现在真的有点想穿越到那个时候给自己来一巴掌</p>\n\n</details>\n<h1 id=\"硬件组成\"><a href=\"#硬件组成\" class=\"headerlink\" title=\"硬件组成\"></a>硬件组成</h1><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\"> </p>\n<p><ol>\n<li>processor: jetson nano 4G</li>\n<li>i-TOF camera: orbbec Femto Bolt</li>\n</ol>\n</p>\n</div>\n<p>我们使用 jetson nano 作为处理器，读取深度相机 Femto Bolt 的视频流并作相应的图像处理，最终将识别出的棋子和棋盘坐标提取出来，通过串口传到下位机MCU进行控制。</p>\n<p><img src=\"https://s2.loli.net/2024/08/12/D3yRmNcGp8eaCjA.jpg\" alt=\"ae17cee48916bb9df3a982c4661bd58.jpg\"></p>\n<hr>\n<h1 id=\"软件部分\"><a href=\"#软件部分\" class=\"headerlink\" title=\"软件部分\"></a>软件部分</h1><p>在 jetson nano 上运行的程序</p>\n<h2 id=\"数据流获取\"><a href=\"#数据流获取\" class=\"headerlink\" title=\"数据流获取\"></a>数据流获取</h2><p>应用奥比中光的orbbecSDK去采深度相机的数据。orbbecSDK的环境配置不过多赘述，不是本篇的重点，如果读者感兴趣，我未来或许会再做。</p>\n<p>不同厂商的相机SDK肯定是不一样的，这里仅作奥比中光相机通过orbbecSDK的数据流获取思路和代码实现<br>(奥比中光相机的SDK和微软realsense相机的SDK是比较相像的应该可以有所借鉴)</p>\n<h3 id=\"获取思路\"><a href=\"#获取思路\" class=\"headerlink\" title=\"获取思路\"></a>获取思路</h3><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>获取视频流管道类Pipeline和视频流配置类Config。<br>获取对RGB和Depth流的配置并使能，主要可以调帧率和分辨率，如果有需要做RGBD对齐这里也可以做。<br>将管道的数据输出成Frameset类的帧格式，Frameset类有很多帧相关的方法。<br>将每一帧Frameset帧数据给转换成numpy数组便可以通过opencv再做处理。</p>\n</div>\n<h3 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> pyorbbecsdk </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> Config </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> pyorbbecsdk </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> OBError</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> pyorbbecsdk </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> OBSensorType</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> OBFormat</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> pyorbbecsdk </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> Pipeline</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> FrameSet</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> pyorbbecsdk </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> VideoStreamProfile</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> utils </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> frame_to_bgr_image</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> pyorbbecsdk </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#相机初始化</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">camera_init</span><span style=\"color: #89DDFF\">():</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    pipeline </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Pipeline</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    config </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">Config</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> pipeline</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> config</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 配置RGB流</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">config_color_stream</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">pipeline</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8; font-style: italic\">config</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">try</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        profile_list </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> pipeline</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_stream_profile_list</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">OBSensorType</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">COLOR_SENSOR</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">try</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            color_profile</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> VideoStreamProfile </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> profile_list</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_stream_profile_by_index</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">except</span><span style=\"color: #BABED8\"> OBError </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> e</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">e</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            color_profile </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> profile_list</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_default_video_stream_profile</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">color profile: </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> color_profile</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        config</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">enable_stream</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">color_profile</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Exception</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> e</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">e</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> config</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 配置深度流</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">config_depth_stream</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">pipeline</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8; font-style: italic\">config</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">try</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        profile_list </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> pipeline</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_stream_profile_list</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">OBSensorType</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">DEPTH_SENSOR</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">try</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            depth_profile </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> profile_list</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_stream_profile_by_index</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">except</span><span style=\"color: #BABED8\"> OBError </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> e</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">e</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            depth_profile </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> profile_list</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_default_video_stream_profile</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">depth profile: </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> depth_profile</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        config</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">enable_stream</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">depth_profile</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Exception</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> e</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">e</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> config</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 配置RGBD对齐</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">config_color_depth_align</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">pipeline</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8; font-style: italic\">config</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    pipeline</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">enable_frame_sync</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    config</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">set_align_mode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">OBAlignMode</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">SW_MODE</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 读颜色深度帧</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">read_color_depth_frame</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">pipeline</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> pipeline</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">wait_for_frames</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">100</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> frame </span><span style=\"color: #89DDFF\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    color_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_color_frame</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> color_frame </span><span style=\"color: #89DDFF\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_depth_frame</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> depth_frame </span><span style=\"color: #89DDFF\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    width </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_width</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    height </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_height</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    scale </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_depth_scale</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">frombuffer</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_data</span><span style=\"color: #89DDFF\">(),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">dtype</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">uint16</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_data</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">reshape</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">height</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> width</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_data</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">astype</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">float32</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> scale</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">where</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">depth_data </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #82AAFF\"> MIN_DEPTH</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&amp;</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">depth_data </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #82AAFF\"> MAX_DEPTH</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> depth_data</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_data</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">astype</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">uint16</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_image </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">normalize</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">depth_data</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">NORM_MINMAX</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">dtype</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">CV_8U</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_image </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">applyColorMap</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">depth_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">COLORMAP_JET</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    color_image </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">frame_to_bgr_image</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">color_frame</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">depth_image</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\">color_image</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> color_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> depth_image</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 读颜色帧</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">read_color_frame</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">pipeline</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> pipeline</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">wait_for_frames</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">100</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> frame </span><span style=\"color: #89DDFF\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    color_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_color_frame</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> color_frame </span><span style=\"color: #89DDFF\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    color_image </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">frame_to_bgr_image</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">color_frame</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> color_image</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 读深度帧</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">read_depth_frame</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">pipeline</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> pipeline</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">wait_for_frames</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">100</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> frame </span><span style=\"color: #89DDFF\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_depth_frame</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> depth_frame </span><span style=\"color: #89DDFF\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    width </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_width</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    height </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_height</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    scale </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_depth_scale</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">frombuffer</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_data</span><span style=\"color: #89DDFF\">(),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">dtype</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">uint16</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_data</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">reshape</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">height</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> width</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_data</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">astype</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">float32</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> scale</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">where</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">depth_data </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #82AAFF\"> MIN_DEPTH</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&amp;</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">depth_data </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #82AAFF\"> MAX_DEPTH</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> depth_data</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_data</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">astype</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">uint16</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 读深度颜色帧</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">read_color_depth_frame</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">pipeline</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> pipeline</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">wait_for_frames</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">100</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> frame </span><span style=\"color: #89DDFF\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    color_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_color_frame</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> color_frame </span><span style=\"color: #89DDFF\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_depth_frame</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> depth_frame </span><span style=\"color: #89DDFF\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    width </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_width</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    height </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_height</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    scale </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_depth_scale</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">frombuffer</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">depth_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_data</span><span style=\"color: #89DDFF\">(),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">dtype</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">uint16</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_data</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">reshape</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">height</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> width</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_data</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">astype</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">float32</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> scale</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">where</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">depth_data </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #82AAFF\"> MIN_DEPTH</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&amp;</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">depth_data </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #82AAFF\"> MAX_DEPTH</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> depth_data</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    depth_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> depth_data</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">astype</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">uint16</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    color_image </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">frame_to_bgr_image</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">color_frame</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> color_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">depth_data</span></span></code></pre></div><h2 id=\"相机标定\"><a href=\"#相机标定\" class=\"headerlink\" title=\"相机标定\"></a>相机标定</h2><details class=\"custom-details\">\n<summary>What is the camera celibration ?</summary>\n<p>相机标定（Camera Calibration）是计算机视觉中的一个重要步骤，旨在确定相机的内参和外参。内参包括焦距、光学中心和畸变系数，外参包括相机在世界坐标系中的位置和方向。通过相机标定，可以将二维图像中的点映射到三维空间中的点，从而实现精确的测量和重建。</p>\n<p>相机标定的主要步骤包括：</p>\n<ol>\n<li><strong>拍摄标定图像</strong>：通常使用棋盘格图案，拍摄多张不同角度的图像。</li>\n<li><strong>检测角点</strong>：在每张图像中检测棋盘格的角点。</li>\n<li><strong>计算内参和外参</strong>：使用检测到的角点和已知的棋盘格尺寸，通过算法（如张正友标定法）计算相机的内参和外参。</li>\n<li><strong>校正图像</strong>：使用计算出的参数校正图像中的畸变。<br>:::</li>\n</ol>\n<h3 id=\"标定思路\"><a href=\"#标定思路\" class=\"headerlink\" title=\"标定思路\"></a>标定思路</h3><p>:::warning<br>我们采用的是固定相机机位的方法，如果想要将我们的运动机构和相机传感做联系是要做手眼标定的。因为我们使用的运动机构是龙门架，由于龙门架自身的特性，我们只需要将相机标定到我们的棋盘平面即可得到比较精准的结果，龙门架的初始点只需要做简单的平移就可以做到与相机标定平面的对应。<br>我们使用<strong>张正友标定法</strong>将相机标定到棋盘平面之上，使用 11x8 grid size 20mm的棋盘格标定板进行标定。</p>\n<p>对张正友标定法感兴趣的读者可以去看这篇论文《A Flexible New Technique for Camera Calibration》</p>\n</details>\n<p>这里提供一个脚本做相机标定</p>\n<details class=\"custom-details\">\n<summary>A script for camera celibration.</summary>\n<p><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> cv2</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> numpy </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> np</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> os</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">script_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dirname</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">abspath</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">__file__</span><span style=\"color: #89DDFF\">))</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">#&lt;-- absolute dir the script is in</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 图片在当前文件夹的位置</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">file_in </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">script_dir</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">p1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">   </span><span style=\"color: #676E95; font-style: italic\"># 原始图片存放位置</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">file_out </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">script_dir</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">p3</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">   </span><span style=\"color: #676E95; font-style: italic\"># 最后图片的保存位置</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 棋盘格模板规格，只算内角点个数，不算最外面的一圈点</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">w </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">11</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">h </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">8</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 没考虑棋盘格的大小，只考虑角点的数量，因此计算出来的平移量要乘上棋盘格的大小</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 找棋盘格角点</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 世界坐标系中的棋盘格点，在张正友标定法中认为Z = 0</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># mgrid创建了大小为8×5×2的三维矩阵，在reshape成二维以后赋给objp，objp最后为(0,0,0), (1,0,0), (2,0,0) ....,(8,5,0)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">objp </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">zeros</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">w </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> h</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">float32</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">   </span><span style=\"color: #676E95; font-style: italic\"># 大小为wh×3的0矩阵</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">objp</span><span style=\"color: #89DDFF\">[:,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">mgrid</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\">w</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\">h</span><span style=\"color: #89DDFF\">].</span><span style=\"color: #F07178\">T</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">reshape</span><span style=\"color: #89DDFF\">(-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">   </span><span style=\"color: #676E95; font-style: italic\"># :2是因为认为Z=0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">objpoints </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 储存在世界坐标系中的三维点</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">imgpoints </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 储存在图像平面的二维点</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">images </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">listdir</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">file_in</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">   </span><span style=\"color: #676E95; font-style: italic\"># 读入图像序列</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">i </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">img_h </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">img_w </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 算法迭代的终止条件，第一项表示迭代次数达到最大次数时停止迭代，第二项表示角点位置变化的最小值已经达到最小时停止迭代</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">criteria </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">TERM_CRITERIA_EPS</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">TERM_CRITERIA_MAX_ITER</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">30</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0.001</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> fname </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> images</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    img </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">imread</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">file_in </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> fname</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    img_h </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">size</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">img</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    img_w </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">size</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">img</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    gray </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">cvtColor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">img</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">COLOR_BGR2GRAY</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">   </span><span style=\"color: #676E95; font-style: italic\"># RGB转灰度</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 找到棋盘格角点，存放角点于corners，如果找到足够点对，将其存储起来，ret为非零值</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    ret</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> corners </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">findChessboardCorners</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">gray</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">w</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> h</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">None)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 检测到角点后，进行亚像素级别角点检测，更新角点</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> ret </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">True:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        i </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 输入图像gray；角点初始坐标corners；搜索窗口为2*winsize+1；表示窗口的最小（-1.-1）表示忽略；求角点的迭代终止条件</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">cornerSubPix</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">gray</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> corners</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">11</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">11</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> criteria</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        objpoints</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">objp</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">   </span><span style=\"color: #676E95; font-style: italic\"># 空间坐标</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        imgpoints</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">corners</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 角点坐标即图像坐标</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 角点显示</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">drawChessboardCorners</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">img</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">w</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> h</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> corners</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> ret</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">imshow</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">findCorners</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> img</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">imwrite</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">file_out </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/print_corners</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">.jpg</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> img</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">waitKey</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">destroyAllWindows</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">&quot;&quot;&quot;</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">求解参数</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">输入：世界坐标系里的位置；像素坐标；图像的像素尺寸大小；</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">输出：</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">ret: 重投影误差；</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">mtx：内参矩阵；</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">dist：畸变系数；</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">rvecs：旋转向量 （外参数）；</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">tvecs：平移向量 （外参数）；</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">&quot;&quot;&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">ret</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> mtx</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> dist</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> rvecs</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> tvecs </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">calibrateCamera</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">objpoints</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> imgpoints</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> gray</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">[::-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">None)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">ret（重投影误差）:</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> ret</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">mtx（内参矩阵）:</span><span style=\"color: #BABED8\">\\n</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> mtx</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">dist（畸变参数）:</span><span style=\"color: #BABED8\">\\n</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> dist</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 5个畸变参数，(k_1,k_2,p_1,p_2,k_3)</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">rvecs（旋转向量）:</span><span style=\"color: #BABED8\">\\n</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> rvecs</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">tvecs（平移向量）:</span><span style=\"color: #BABED8\">\\n</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> tvecs</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 优化内参数和畸变系数</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 使用相机内参mtx和畸变系数dist，并使用cv.getOptimalNewCameraMatrix()</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 通过设定自由自由比例因子alpha。</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 当alpha设为0的时候，将会返回一个剪裁过的将去畸变后不想要的像素去掉的内参数和畸变系数；</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 当alpha设为1的时候，将会返回一系个包含额外黑色像素点的内参数和畸变数，并返回一个ROI用于将其剪裁掉。</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">newcameramtx</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> roi </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getOptimalNewCameraMatrix</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">mtx</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> dist</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">img_w</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> img_h</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">img_w</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> img_h</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 矫正畸变</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">img2 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">imread</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">file_in </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">\\\\</span><span style=\"color: #C3E88D\">img_0.jpg</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 第几张图片</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">dst </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">undistort</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">img2</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> mtx</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> dist</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #82AAFF\"> newcameramtx</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">imwrite</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">file_out </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/calibresult.jpg</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> dst</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">newcameramtx（优化后相机内参）:</span><span style=\"color: #BABED8\">\\n</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> newcameramtx</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 反投影误差total_error,越接近0，说明结果越理想。</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">total_error </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">objpoints</span><span style=\"color: #89DDFF\">)):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    imgpoints2</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> _ </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">projectPoints</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">objpoints</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> rvecs</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> tvecs</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> mtx</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> dist</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">   </span><span style=\"color: #676E95; font-style: italic\"># 计算三维点到二维图像的投影</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    error </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">norm</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">imgpoints</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> imgpoints2</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">NORM_L2</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">imgpoints2</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">   </span><span style=\"color: #676E95; font-style: italic\"># 反投影得到的点与图像上检测到的点的误差</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    total_error </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> error</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">total error: </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> total_error </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">objpoints</span><span style=\"color: #89DDFF\">))</span><span style=\"color: #BABED8\">   </span><span style=\"color: #676E95; font-style: italic\"># 记平均</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 将旋转向量转换为旋转矩阵</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">R</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> _ </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">Rodrigues</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">rvecs</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 构建外参矩阵</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">extrinsic_matrix </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">hstack</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">R</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> tvecs</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]))</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">外参矩阵：</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">extrinsic_matrix</span><span style=\"color: #89DDFF\">)</span></span></code></pre></div></p>\n</details>\n<h2 id=\"坐标系映射\"><a href=\"#坐标系映射\" class=\"headerlink\" title=\"坐标系映射\"></a>坐标系映射</h2><p>做完相机的内外参标定之后就可以通过深度数据、相机内参K和相机外参E去建立标定的世界坐标系和我们相机的像素坐标系之间的映射关系。</p>\n<h3 id=\"原理公式\"><a href=\"#原理公式\" class=\"headerlink\" title=\"原理公式\"></a>原理公式</h3><div class=\"custom-quote danger\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M19.76 5.23C15.84 5.23 12 2 12 2C12 2 8.15996 5.23 4.23996 5.23C4.23996 5.23 1.86996 16.99 12 22C22.13 16.99 19.76 5.23 19.76 5.23Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 16H12\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">!!!</p>\n<p>捏嘿^o^待补充~~~~</p>\n\n</div>\n<h3 id=\"代码实现-1\"><a href=\"#代码实现-1\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 世界坐标系到像素坐标系的投影</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">project_world_to_pixel</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">point_3d</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 将3D点转换为齐次坐标</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    point_world </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">vstack</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">point_3d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">reshape</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 将3D点从世界坐标系转换到相机坐标系</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    point_camera </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> Rt </span><span style=\"color: #89DDFF\">@</span><span style=\"color: #BABED8\"> point_world</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 求出齐次坐标下的像素坐标</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    point_pixel_homogeneous </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> K </span><span style=\"color: #89DDFF\">@</span><span style=\"color: #BABED8\"> point_camera</span><span style=\"color: #89DDFF\">[:</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 归一化像素坐标</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    point_pixel </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> point_pixel_homogeneous </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> point_pixel_homogeneous</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> point_pixel</span><span style=\"color: #89DDFF\">[:</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 像素坐标系到世界坐标系的投影</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">project_pixel_to_world</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">point_pixel</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">depth</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">t</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    Rt_extended </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">vstack</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">Rt</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    point_pixel_homogeneous </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">vstack</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">point_pixel</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    point_camera </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">linalg</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">inv</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">K</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">@</span><span style=\"color: #BABED8\"> point_pixel_homogeneous</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    point_camera </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> point_camera </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> depth</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    point_camera_homogeneous </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">vstack</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">point_camera</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    point_world_homogeneous </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">linalg</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">inv</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">Rt_extended</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">@</span><span style=\"color: #BABED8\"> point_camera_homogeneous</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    point_world </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> point_world_homogeneous</span><span style=\"color: #89DDFF\">[:</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> point_world_homogeneous</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> point_world</span></span></code></pre></div><h2 id=\"棋盘检测\"><a href=\"#棋盘检测\" class=\"headerlink\" title=\"棋盘检测\"></a>棋盘检测</h2><p>由于比赛的时间关系，我采用的是传统2D视觉图像处理的方法来检测棋盘。</p>\n<h3 id=\"检测思路\"><a href=\"#检测思路\" class=\"headerlink\" title=\"检测思路\"></a>检测思路</h3><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>采用传统轮廓检测算法，首先进行canny边缘提取，通过设置相应的阈值实现将棋盘的边缘进行提取，再执行膨胀操作，将内外边缘合一，通过设置面积特征、形状特征和边长特征的提取，将我对棋盘的ROI区域画出来，完成对棋盘外轮廓的确定。再通过棋盘三等分的几何特性，我将九个格子的十六个格点分别进行提取，再根据这十六个格点相邻之间的像素坐标关系，计算出各个格子的中心点的像素坐标值，由此完成对棋盘的识别。</p>\n</div>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">MY VIEW</p>\n<p>优点：图像处理算法相对简单运行起来帧率高。<br>缺陷：需要固定相机位，如果相机位置改变则需要改很多参数。</p>\n\n</div>\n<h3 id=\"代码实现-2\"><a href=\"#代码实现-2\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 找棋盘格</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">find_chessboard</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">color_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">depth_image</span><span style=\"color: #89DDFF\">=None):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    find_center_method </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    pixels_threshold </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">80</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    area_threshold </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">50</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    appo_contour </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    grid_size </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    sorted_center_list </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 排序后的中心点像素坐标列表</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 转换为灰度图像</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    gray_image </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">cvtColor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">color_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">COLOR_RGB2GRAY</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 高斯模糊</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># blurred_image = cv2.GaussianBlur(gray_image, (5, 5), 0)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 边缘检测</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    edged </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">Canny</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">gray_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">75</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">150</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 膨胀处理</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    kernel </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">ones</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">uint8</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    dilated </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dilate</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">edged</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> kernel</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">iterations</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># cv2.imshow(&quot;dilated&quot;,dilated)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 选取ROI区域</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    dilated_ROI </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> dilated</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">10</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F78C6C\">700</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F78C6C\">100</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F78C6C\">900</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># ROI与原图像对齐</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    dilated_ROI </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">extend_frame_boarden</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">dilated_ROI</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">imshow</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">dilated_ROI</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\">dilated_ROI</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 查找轮廓</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    contours</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> _ </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">findContours</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">dilated_ROI</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">RETR_EXTERNAL</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">CHAIN_APPROX_SIMPLE</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    contours </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">sorted</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">contours</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">key</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">contourArea</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">reverse</span><span style=\"color: #89DDFF\">=True)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">contours</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 筛选出最大的轮廓</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        largest_contour </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> contours</span><span style=\"color: #89DDFF\">[:</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> contour </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> largest_contour</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            area </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">contourArea</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">contour</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 近似多边形</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            epsilon </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0.02</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">arcLength</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">contour</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">True)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            approx </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">approxPolyDP</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">contour</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> epsilon</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">True)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># print(area,approx)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">approx</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">               </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> area </span><span style=\"color: #89DDFF\">&gt;=</span><span style=\"color: #F78C6C\">30000</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">and</span><span style=\"color: #BABED8\"> area </span><span style=\"color: #89DDFF\">&lt;=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">50000</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                appo_contour </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> contour</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #676E95; font-style: italic\"># corners = approx.reshape((4, 2))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">break</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> appo_contour </span><span style=\"color: #89DDFF\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            corners </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> approx</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">reshape</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            tl </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> corners</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            bl </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> corners</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            br </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> corners</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            tr </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> corners</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 计算3x3格子的交叉点</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            cross_points </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> j </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #676E95; font-style: italic\"># 线性插值计算交叉点</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    cross_x </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">tl</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #82AAFF\"> i</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> tr</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> i</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #82AAFF\"> j</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">9</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                                </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">bl</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #82AAFF\"> i</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> br</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> i</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> j </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">9</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    cross_y </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">tl</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #82AAFF\"> i</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> tr</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> i</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #82AAFF\"> j</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">9</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                                </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">bl</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #82AAFF\"> i</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> br</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> i</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> j </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">9</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    cross_points</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">cross_x</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cross_y</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">circle</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">color_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cross_x</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cross_y</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            distances </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 计算每行相邻交叉点的距离</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> j </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    p1 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cross_points</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">i </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> j</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    p2 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cross_points</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">i </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> j </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    distance </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">sqrt</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">p1</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #82AAFF\"> p2</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">])</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">**</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">p1</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #82AAFF\"> p2</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">])</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">**</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    distances</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">distance</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 计算每列相邻交叉点的距离</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> j </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    p1 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cross_points</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">i </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> j</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    p2 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cross_points</span><span style=\"color: #89DDFF\">[(</span><span style=\"color: #BABED8\">i </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> j</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    distance </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">sqrt</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">p1</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #82AAFF\"> p2</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">])</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">**</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">p1</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #82AAFF\"> p2</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">])</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">**</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    distances</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">distance</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            grid_size </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">mean</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">distances</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># print(&quot;grid_size is&quot;, grid_size)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            centers </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 找格子中心点方法一：直接根据顶点计算</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\">#if find_center_method == 1:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> j </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    center_x </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">cross_points</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> j</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> cross_points</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> j </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> cross_points</span><span style=\"color: #89DDFF\">[(</span><span style=\"color: #82AAFF\">i </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> j</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> cross_points</span><span style=\"color: #89DDFF\">[(</span><span style=\"color: #82AAFF\">i </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> j </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">])</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    center_y </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">cross_points</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> j</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> cross_points</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> j </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> cross_points</span><span style=\"color: #89DDFF\">[(</span><span style=\"color: #82AAFF\">i </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> j</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> cross_points</span><span style=\"color: #89DDFF\">[(</span><span style=\"color: #82AAFF\">i </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> j </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">])</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    centers</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">center_x</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> center_y</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">circle</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">color_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">center_x</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> center_y</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># elif find_center_method == 2:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 对找到的中心点进行编号, y + x 最大就是右下角，最小就是左上角， y-x 最大就是左下角，y-x 最小就是右上角，其它几个点根据在旁边两个点中间判断</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">centers</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">9</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                centers </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">array</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">centers</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                rect </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">zeros</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #F78C6C\">9</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">dtype</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">float32</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                dist </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">zeros</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">9</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">dtype</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">float32</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                s </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> centers</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">sum</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">axis</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                idx_0 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">argmin</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">s</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                idx_8 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">argmax</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">s</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                diff </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">diff</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">centers</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">axis</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                idx_2 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">argmin</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">diff</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                idx_6 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">argmax</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">diff</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> centers</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">idx_0</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> centers</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">idx_2</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">6</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> centers</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">idx_6</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">8</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> centers</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">idx_8</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #676E95; font-style: italic\">#   其它点</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                calc_center </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">6</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">8</span><span style=\"color: #89DDFF\">])</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">4</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                mask </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">zeros</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">centers</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">dtype</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFCB6B\">bool</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                idxes </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">7</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                mask</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">idxes</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">True</span><span style=\"color: #BABED8\">    </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #676E95; font-style: italic\"># 筛选出其他中心点</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                others </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> centers</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">mask</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #676E95; font-style: italic\"># 找到最左、最右、最上和最下的点的索引</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                idx_l </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> others</span><span style=\"color: #89DDFF\">[:,</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">].</span><span style=\"color: #82AAFF\">argmin</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                idx_r </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> others</span><span style=\"color: #89DDFF\">[:,</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">].</span><span style=\"color: #82AAFF\">argmax</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                idx_t </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> others</span><span style=\"color: #89DDFF\">[:,</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">].</span><span style=\"color: #82AAFF\">argmin</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                idx_b </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> others</span><span style=\"color: #89DDFF\">[:,</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">].</span><span style=\"color: #82AAFF\">argmax</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                found </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">array</span><span style=\"color: #89DDFF\">([</span><span style=\"color: #82AAFF\">idx_l</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> idx_r</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> idx_t</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> idx_b</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                mask </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">isin</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">others</span><span style=\"color: #89DDFF\">)),</span><span style=\"color: #82AAFF\"> found</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">invert</span><span style=\"color: #89DDFF\">=False)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                idx_c </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">where</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">mask </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">False)[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">idx_c</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> others</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">idx_t</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> others</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">idx_l</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> others</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">idx_c</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> others</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">idx_r</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">7</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> others</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">idx_b</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #676E95; font-style: italic\"># 写编号</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">9</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                                                                        </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #676E95; font-style: italic\"># print(f&quot;&#123;i&#125;格的中心点&quot;,rect[i][0],rect[i][1])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">putText</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">color_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">])),</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">FONT_HERSHEY_SIMPLEX</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0.5</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        sorted_center_list</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">rect</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">])))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #676E95; font-style: italic\"># 大于 45度的情况</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">&gt; 45 degree</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">without appopriate contour</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> sorted_center_list </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">sorted_center_list</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">locals</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[],</span><span style=\"color: #BABED8\"> grid_size </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">grid_size</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">locals</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span></code></pre></div><h2 id=\"棋子检测\"><a href=\"#棋子检测\" class=\"headerlink\" title=\"棋子检测\"></a>棋子检测</h2><p>这里提供两种方法</p>\n<h3 id=\"3DV方法\"><a href=\"#3DV方法\" class=\"headerlink\" title=\"3DV方法\"></a>3DV方法</h3><p>3D视觉方法</p>\n<h4 id=\"实现思路\"><a href=\"#实现思路\" class=\"headerlink\" title=\"实现思路\"></a>实现思路</h4><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>采用二值化+3D点云数据融合分辨黑色棋子和白色棋子。<br>首先，通过对图像滤波再做二值化处理就可以得到黑色棋子的完美轮廓，通过棋子形状和面积等方法去提取出黑色棋子的中心坐标点。再通过对相机做depth和RGB的数据对齐，可以使得到的点云数据和RGB数据有一个对应关系，将点云数据提取出来之后，由于棋盘是一个光滑平面，可以通过ransac拟合平面，再通过点云处理将这个平面给隐藏，再通过 DBSCAN 聚类提取出每个棋子的点云，选取棋子点云中心点作为棋子的相机坐标系坐标，再将每个棋子的相机坐标系坐标映射到像素坐标系上，便可以得到棋子的像素坐标中心点，再将之前二值化得到的黑色棋子的中心坐标点剔除，剩下的就是白色棋子中心点像素坐标。由此，我们成功地完成了对棋子的识别。</p>\n</div>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">MY VIEW</p>\n<p>优点：识别基本不受环境光线的干扰，通过三维的信息来识别棋子，你放张棋子照片上去也不会误识别。<br>缺点：点云数据量大，即使做了降采样和裁切之后对算力的要求仍旧很高，帧率很低，体验3帧电竞，对一些实时性有要求的场景不太适合。</p>\n\n</div>\n<h3 id=\"代码实现（仅代码块）\"><a href=\"#代码实现（仅代码块）\" class=\"headerlink\" title=\"代码实现（仅代码块）\"></a>代码实现（仅代码块）</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 拟合平面ransac </span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">fit_plane</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">points</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    pcd </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> o3d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">geometry</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">PointCloud</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    pcd</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">points</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> o3d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">utility</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">Vector3dVector</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">points</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    plane_model</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> inliers </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> pcd</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">segment_plane</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">distance_threshold</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">0.27</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                                             </span><span style=\"color: #BABED8; font-style: italic\">ransac_n</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                                             </span><span style=\"color: #BABED8; font-style: italic\">num_iterations</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">1000</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> plane_model</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> inliers</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">detect_objects_on_plane</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">points</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">distance_threshold</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 拟合平面模型，返回平面模型参数和内点索引</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    plane_model</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> inliers </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">fit_plane</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">points</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 解包平面模型参数 a, b, c, d</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">a</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> b</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> c</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> d</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> plane_model</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 计算每个点到平面的距离</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    distances </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">abs</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">a </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> points</span><span style=\"color: #89DDFF\">[:,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> b </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> points</span><span style=\"color: #89DDFF\">[:,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> c </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> points</span><span style=\"color: #89DDFF\">[:,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> d</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">sqrt</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">a</span><span style=\"color: #89DDFF\">**</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> b</span><span style=\"color: #89DDFF\">**</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> c</span><span style=\"color: #89DDFF\">**</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 找到距离大于阈值的点的索引</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    object_indices </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">where</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">distances </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #82AAFF\"> distance_threshold</span><span style=\"color: #89DDFF\">)[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 提取这些点作为检测到的物体</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    objects </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> points</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">object_indices</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    objects_pcd </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> o3d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">geometry</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">PointCloud</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    objects_pcd</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">points</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> o3d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">utility</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">Vector3dVector</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">objects</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    cl</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> ind </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> objects_pcd</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">remove_statistical_outlier</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">nb_neighbors</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">20</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">std_ratio</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">2.0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    filtered_pcd </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> objects_pcd</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">select_by_index</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">ind</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 返回检测到的物体点云 </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> objects_pcd</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 使用 DBSCAN 聚类算法提取不同物体</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">extract_objects_from_pcd</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">objects_pcd</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">eps</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">min_points</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">10</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 进行 DBSCAN 聚类</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    labels </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">array</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">objects_pcd</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">cluster_dbscan</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">eps</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">eps</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">min_points</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">min_points</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">print_progress</span><span style=\"color: #89DDFF\">=True))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 获取聚类数目</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    max_label </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> labels</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">max</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;point cloud has </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">max_label </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1&#125;</span><span style=\"color: #C3E88D\"> clusters&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 将不同聚类的点云提取出来</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    clusters </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">max_label </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        cluster_indices </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">where</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">labels </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #82AAFF\"> i</span><span style=\"color: #89DDFF\">)[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        cluster_pcd </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> objects_pcd</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">select_by_index</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cluster_indices</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        clusters</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cluster_pcd</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> clusters</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">pcd </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">convert_to_o3d_point_cloud</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">array</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">points</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 降采样</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">downsampled_pcd </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> pcd</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">voxel_down_sample</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">voxel_size</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">0.01</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 裁剪点云</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 定义包围盒的最小和最大边界点</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 创建轴对齐包围盒</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">aabb </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> pcd</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">get_axis_aligned_bounding_box</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">min_bound </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> aabb</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">min_bound</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">max_bound </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> aabb</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">max_bound</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">aabb1 </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> o3d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">geometry</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">AxisAlignedBoundingBox</span><span style=\"color: #89DDFF\">([</span><span style=\"color: #82AAFF\">min_bound</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]+</span><span style=\"color: #F78C6C\">250</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\">min_bound</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]+</span><span style=\"color: #F78C6C\">200</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\">min_bound</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]],</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                                                </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">max_bound</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]-</span><span style=\"color: #F78C6C\">250</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\">max_bound</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]-</span><span style=\"color: #F78C6C\">200</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\">max_bound</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cropped_pcd </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> downsampled_pcd</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">crop</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">aabb1</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 将 Open3D 点云对象转换为 numpy 数组</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">points_np </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">asarray</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cropped_pcd</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">points</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">objects_pcd </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">detect_objects_on_plane</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">points_np</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 提取不同物体的点云</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cluster_pcd_list </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">extract_objects_from_pcd</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">objects_pcd</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 可视化处理后的点云</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 创建坐标系对象</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">coordinate_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> o3d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">geometry</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">TriangleMesh</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">create_coordinate_frame</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">size</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">100</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">origin</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">o3d</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">visualization</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">draw_geometries</span><span style=\"color: #89DDFF\">([</span><span style=\"color: #82AAFF\">coordinate_frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cluster_pcd_list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]])</span></span></code></pre></div><h3 id=\"2DV方法\"><a href=\"#2DV方法\" class=\"headerlink\" title=\"2DV方法\"></a>2DV方法</h3><p>传统2D视觉方法</p>\n<h4 id=\"实现思路-1\"><a href=\"#实现思路-1\" class=\"headerlink\" title=\"实现思路\"></a>实现思路</h4><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>采用背景减除+不同色域提取掩膜将黑色棋子和白色棋子在红色背景下提取出来。<br>首先，采用固定机位的相机因此可以相对准确的标记出大致的ROI区域。根据环境预先获取没有棋子的相机RGB图，在处理时对相机的帧数据上与预先的背景RGB图的每个通道做绝对求差，比较两个图像的像素值，提取出前景对象。这样可以很好的将棋子的轮廓和背景之间进行分离。根据分离出来的颜色的对比程度，可以简易判断做掩膜提取效果较好的空间色域。将分离出来的前景图像在RGB空间中做色域提取，通过设置RGB颜色阈值可以将黑色棋子很容易的提取出来，均值滤波后通过K_Means聚类算法将轮廓聚集，二值化前景得到掩膜图。通过上述步骤，就成功地在掩膜图上提取到了特别完整的棋子轮廓，再通过轮廓检测将棋子的中心像素坐标值进行确定，将这个中心坐标和轮廓匹配对齐到RGB帧图像上，最终完成对棋子的识别。</p>\n</div>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">MY VIEW</p>\n<p>优点：识别速度快，算法简单。<br>缺点：会受到环境光的影响，鲁棒性较差，只能使用在理想测试环境下，实际工况复杂需要更多的其他增强稳定性的算法，可以考虑机器学习那一套搞决策树、随机森林、支持向量机之类的（这个后续我也会跟进去学习的）。</p>\n\n</div>\n<h4 id=\"代码实现-3\"><a href=\"#代码实现-3\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h4><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 自适应调节rgb阈值 </span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">adjust_rgb_range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">base_lower</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">base_upper</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 计算图像的加权平均亮度</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    brightness </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">mean</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">image</span><span style=\"color: #89DDFF\">[:,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">:,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0.299</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> image</span><span style=\"color: #89DDFF\">[:,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">:,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0.587</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> image</span><span style=\"color: #89DDFF\">[:,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">:,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0.114</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 根据亮度调整色域范围</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    adjustment_factor </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> brightness </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">128.0</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 假设 128 是中等亮度</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    lower_rgb </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">array</span><span style=\"color: #89DDFF\">([</span><span style=\"color: #82AAFF\">base_lower</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> adjustment_factor</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> base_lower</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> adjustment_factor</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> base_lower</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> adjustment_factor</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">dtype</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">uint8</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    upper_rgb </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">array</span><span style=\"color: #89DDFF\">([</span><span style=\"color: #82AAFF\">base_upper</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> adjustment_factor</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> base_upper</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> adjustment_factor</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> base_upper</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> adjustment_factor</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">dtype</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">uint8</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 背景减除二值化</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">background_bin_subtraction</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">background</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">current_frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">binary_threshold</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">100</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 调整二值化阈值 binary_threshold 可以有效地筛选黑白棋</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 调整图像尺寸和通道数</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> background</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">!=</span><span style=\"color: #BABED8\"> current_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        current_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">resize</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">current_frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">background</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> background</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">background</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">and</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">current_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            current_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">cvtColor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">current_frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">COLOR_BGR2GRAY</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">elif</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">background</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">and</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">current_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            current_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">cvtColor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">current_frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">COLOR_GRAY2BGR</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    foreground </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">absdiff</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">background</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> current_frame</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #C792EA\">global</span><span style=\"color: #BABED8\"> foreground_image </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    foreground_image </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> foreground</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    gray_foreground </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">cvtColor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">foreground</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">COLOR_BGR2GRAY</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    _</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> binary_foreground </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">threshold</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">gray_foreground</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> binary_threshold</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">THRESH_BINARY</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> binary_foreground</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 背景减除RGB空间</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">background_rgb_subtraction</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">background</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">current_frame</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    rgb_low_threshold </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">array</span><span style=\"color: #89DDFF\">([</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">160</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    rgb_high_threshold </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">array</span><span style=\"color: #89DDFF\">([</span><span style=\"color: #F78C6C\">65</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">50</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">235</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 调整图像尺寸和通道数</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> background</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">!=</span><span style=\"color: #BABED8\"> current_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        current_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">resize</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">current_frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">background</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> background</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">background</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">and</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">current_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            current_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">cvtColor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">current_frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">COLOR_BGR2GRAY</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">elif</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">background</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">and</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">current_frame</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            current_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">cvtColor</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">current_frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">COLOR_GRAY2BGR</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 计算差值</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    foreground </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">absdiff</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">background</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> current_frame</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    mask </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">inRange</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">foreground</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> rgb_low_threshold</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> rgb_high_threshold</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\">#cv2.imshow(&quot;mask&quot;, mask)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> mask</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 找白色棋子</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">find_white_piece</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">color_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8; font-style: italic\">area_low_threshold</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1000</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">area_high_threshold</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">10000</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 棋子认定面积阈值</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># area_low_threshold</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># area_high_threshold</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 背景减除二值化</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    white_piece_center_list </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    foreground </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">background_bin_subtraction</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">background_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> color_image</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 使用形态学操作</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    kernel </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getStructuringElement</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">MORPH_RECT</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># closed = cv2.morphologyEx(foreground, cv2.MORPH_CLOSE, kernel)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\">#腐蚀</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    erode </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">erode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">foreground</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> kernel</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">iterations</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 膨胀</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    dilate </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dilate</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">erode</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> kernel</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">iterations</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># cv2.imshow(&quot;dilate&quot;,dilate)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 查找轮廓</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    contours</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> _ </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">findContours</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">dilate</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">copy</span><span style=\"color: #89DDFF\">(),</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">RETR_EXTERNAL</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">CHAIN_APPROX_SIMPLE</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    i </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> contour </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> contours</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 计算并绘制外接矩形框</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        x</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> y</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> w</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> h </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">boundingRect</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">contour</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">rectangle</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">foreground</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">x</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> y</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">x </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> w</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> y </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> h</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        area </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">contourArea</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">contour</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> area </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> area_low_threshold </span><span style=\"color: #89DDFF\">and</span><span style=\"color: #BABED8\"> area </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #BABED8\"> area_high_threshold</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            i </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 绘制轮廓</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">drawContours</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">foreground</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">contour</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 计算轮廓的矩</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            M </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">moments</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">contour</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 计算轮廓的质心</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> M</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">m00</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">!=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                cX </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">M</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">m10</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> M</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">m00</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                cY </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">M</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">m01</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> M</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">m00</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                cX</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> cY </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\">## 打印质心坐标</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\">#print(f&quot;Contour &#123;i&#125; center: (&#123;cX&#125;, &#123;cY&#125;)&quot;)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 添加到白棋中心点列表</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            white_piece_center_list</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">cX</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cY</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 在质心处绘制数字</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">putText</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">foreground</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cX </span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cY</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">FONT_HERSHEY_SIMPLEX</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0.5</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">without any chess</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> white_piece_center_list</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> foreground</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 找黑色棋子</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">fine_black_piece</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">color_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8; font-style: italic\">area_low_threshold</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1000</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">area_high_threshold</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">40000</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    black_piece_center_list </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    foreground </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">background_rgb_subtraction</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">background_image</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> color_image</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    kernel </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getStructuringElement</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">MORPH_RECT</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    dilate </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dilate</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">foreground</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">iterations</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\">#腐蚀</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    erode </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">erode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">dilate</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> kernel</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">iterations</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 膨胀</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    dilate </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dilate</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">erode</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> kernel</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">iterations</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># cv2.imshow(&quot;dilate&quot;,dilate)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    contours</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> _ </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">findContours</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">dilate</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">copy</span><span style=\"color: #89DDFF\">(),</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">RETR_EXTERNAL</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">CHAIN_APPROX_SIMPLE</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    i </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> contour </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> contours</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        area </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">contourArea</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">contour</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 计算并绘制外接矩形框</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        x</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> y</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> w</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> h </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">boundingRect</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">contour</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># print(w*h)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> area </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> area_low_threshold </span><span style=\"color: #89DDFF\">and</span><span style=\"color: #BABED8\"> area </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #BABED8\"> area_high_threshold</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            i </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 绘制轮廓</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">drawContours</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">foreground</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">contour</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 计算轮廓的矩</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            M </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">moments</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">contour</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 计算轮廓的质心</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> M</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">m00</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">!=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                cX </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">M</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">m10</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> M</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">m00</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                cY </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">M</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">m01</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> M</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">m00</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                cX</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> cY </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># # 打印质心坐标</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># print(f&quot;Contour &#123;i&#125; center: (&#123;cX&#125;, &#123;cY&#125;)&quot;)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            black_piece_center_list</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">cX</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cY</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 在质心处绘制数字</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">putText</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">foreground</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cX </span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> cY</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">FONT_HERSHEY_SIMPLEX</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0.5</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">without any chess</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> black_piece_center_list</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> foreground</span></span></code></pre></div><h3 id=\"串口通信\"><a href=\"#串口通信\" class=\"headerlink\" title=\"串口通信\"></a>串口通信</h3><p>通过串口通信与下位机通信</p>\n<h3 id=\"实现思路-2\"><a href=\"#实现思路-2\" class=\"headerlink\" title=\"实现思路\"></a>实现思路</h3><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>在做这个串口通信的时候，使用的是serial库用python来进行串口通信，这个其实是人家通过C++写的封装成python库来用的相对会有很多的受限。因为jetson nano没有硬件中断，所以只能采用多线程的方式来模拟中断。所以调用threading库去实现对串口数据的监听。</p>\n</div>\n<h3 id=\"代码实现-4\"><a href=\"#代码实现-4\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> threading</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> serial </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 串口读取数据线程</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">class</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">SerialCommunication</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">__init__</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178; font-style: italic\">self</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">port</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">baudrate</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">serial_port</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> serial</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">Serial</span><span style=\"color: #89DDFF\">(</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">            </span><span style=\"color: #BABED8; font-style: italic\">port</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">port</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">            </span><span style=\"color: #BABED8; font-style: italic\">baudrate</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">baudrate</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">            </span><span style=\"color: #BABED8; font-style: italic\">bytesize</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">serial</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">EIGHTBITS</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">            </span><span style=\"color: #BABED8; font-style: italic\">parity</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">serial</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">PARITY_NONE</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">            </span><span style=\"color: #BABED8; font-style: italic\">stopbits</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">serial</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">STOPBITS_ONE</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">            </span><span style=\"color: #BABED8; font-style: italic\">timeout</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">        </span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">read_from_port</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178; font-style: italic\">self</span><span style=\"color: #89DDFF\">):</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 监听串口数据</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">True:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">try</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">serial_port</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">in_waiting</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">serial_port</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">readline</span><span style=\"color: #89DDFF\">().</span><span style=\"color: #82AAFF\">decode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">utf-8</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #82AAFF\">rstrip</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;Receive:</span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">data</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #676E95; font-style: italic\"># 读到的数据会存入data，可以自己再写类的接口把这个data读出来</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Exception</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> e</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;An error occurred: </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">e</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&quot;</span><span style=\"color: #89DDFF\">)</span></span></code></pre></div><h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>解决了最大头的图像处理部分之后剩下的其实就是一些简单的逻辑判断了，基本就是一些if-else，我感觉不太重要就不太想讲了。就是作三子棋对弈算法会麻烦一点不过也没什么的我就也放在这里了。</p>\n</div>\n<p>这里提供一点我当时写的函数</p>\n<details class=\"custom-details\">\n<summary>对接对弈算法的</summary>\n<p><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 检查棋子是否在格子内，只是简单判断，通过比较点的坐标和格子的边界来判断点是否在格子内，复杂的需要考虑坐标系映射</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">is_point_in_grid</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">point</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">grid_center</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">grid_size</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">piece_radius</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    half_size </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> grid_size </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">grid_center</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\"> half_size </span><span style=\"color: #89DDFF\">&lt;=</span><span style=\"color: #BABED8\"> point</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&lt;=</span><span style=\"color: #BABED8\"> grid_center</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> half_size </span><span style=\"color: #89DDFF\">and</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            grid_center</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\"> half_size </span><span style=\"color: #89DDFF\">&lt;=</span><span style=\"color: #BABED8\"> point</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&lt;=</span><span style=\"color: #BABED8\"> grid_center</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> half_size</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 检查棋子在哪个格子内</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">check_pieces_in_grids</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">grid_centers</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">black_piece_centers</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">white_piece_centers</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">grid_size</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">black_piece_radius</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">white_piece_radius</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    grid_status </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    black_pieces_outside </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    white_pieces_outside </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> grid_center </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> grid_centers</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        status </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">empty</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> black_center </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> black_piece_centers</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">is_point_in_grid</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">black_center</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> grid_center</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> grid_size</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> black_piece_radius</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                status </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">black</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">break</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> white_center </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> white_piece_centers</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">is_point_in_grid</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">white_center</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> grid_center</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> grid_size</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> white_piece_radius</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                status </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">white</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">break</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        grid_status</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">status</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 检查不在任何格子内的黑棋</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> black_center </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> black_piece_centers</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        in_any_grid </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">any</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">is_point_in_grid</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">black_center</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> grid_center</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> grid_size</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> black_piece_radius</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #82AAFF\"> grid_center </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #82AAFF\"> grid_centers</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> in_any_grid</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            black_pieces_outside</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">black_center</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 检查不在任何格子内的白棋</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> white_center </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> white_piece_centers</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        in_any_grid </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">any</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">is_point_in_grid</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">white_center</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> grid_center</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> grid_size</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> white_piece_radius</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #82AAFF\"> grid_center </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #82AAFF\"> grid_centers</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> in_any_grid</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            white_pieces_outside</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">white_center</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> grid_status</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> black_pieces_outside</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> white_pieces_outside</span></span></code></pre></div></p>\n</details>\n<details class=\"custom-details\">\n<summary>对弈算法</summary>\n<p>使用的是在棋类对弈中广泛使用的Minimax算法。又名极小化极大算法，是一种找出失败的最大可能性中的最小值的算法。Minimax算法常用于棋类等由两方较量的游戏和程序。该算法是一个零总和算法，即一方要在可选的选项中选择将其优势最大化的选择，另一方则选择令对手优势最小化的方法。<br>而系统中函数的具体实现是minmax函数，而best_move函数则是通过调用minmax函数来找到机器的最佳移动位置，其返回值为机器的最佳移动位置。<br>具体来说，Minimax算法模拟了所有可能的棋盘状态，本设计中的minmax函数返回值为得分，用于表示当前棋盘对玩家的有利程度，其主要包含以下几个步骤：</p>\n<ol>\n<li>检查当前棋盘状态是否有胜利者。如果有胜利者，返回相应的分数。</li>\n<li>检查棋盘是否已满。如果已满，返回 0 表示平局。</li>\n<li>如果轮到机器移动，则尝试所有可能的移动，返回得分最高的移动。</li>\n<li>如果轮到人类移动，则尝试所有可能的移动，返回得分最低的移动。minmax函数的具体实现见附录1。</li>\n</ol>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#################################################################################################</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 定义常量</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">PLAYER_X </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\">#机器棋</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">PLAYER_O </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\">#玩家棋</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">EMPTY </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\">       </span><span style=\"color: #676E95; font-style: italic\">#无</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">check_winner</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">board</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 检查行、列和对角线</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    lines </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]],</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]],</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]],</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]],</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]],</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]],</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]],</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> line </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> lines</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> line </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">PLAYER_X</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> PLAYER_X</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> PLAYER_X</span><span style=\"color: #89DDFF\">]:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> PLAYER_X</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> line </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">PLAYER_O</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> PLAYER_O</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> PLAYER_O</span><span style=\"color: #89DDFF\">]:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> PLAYER_O</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">is_board_full</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">board</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">all</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cell </span><span style=\"color: #89DDFF\">!=</span><span style=\"color: #82AAFF\"> EMPTY </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #82AAFF\"> row </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #82AAFF\"> board </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #82AAFF\"> cell </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #82AAFF\"> row</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">minimax</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">board</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">is_maximizing</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    winner </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">check_winner</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">board</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> winner </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> PLAYER_X</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> winner </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> PLAYER_O</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">is_board_full</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">board</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> is_maximizing</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        best_score </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #FFCB6B\">float</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">inf</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> row </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> col </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">col</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> EMPTY</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">col</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> PLAYER_X</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    score </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">minimax</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">board</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">False)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">col</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> EMPTY</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    best_score </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">max</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">score</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> best_score</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> best_score</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        best_score </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">float</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">inf</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> row </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> col </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">col</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> EMPTY</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">col</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> PLAYER_O</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    score </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">minimax</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">board</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">True)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">col</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> EMPTY</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    best_score </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">min</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">score</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> best_score</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> best_score</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">best_move</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">board</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    best_score </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #FFCB6B\">float</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">inf</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    move </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> row </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> col </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">col</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> EMPTY</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">col</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> PLAYER_X</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                score </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">minimax</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">board</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">False)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">col</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> EMPTY</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> score </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> best_score</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    best_score </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> score</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    move </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> col</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">get_board</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">chessboard_block_list</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8; font-style: italic\">black_piece_list</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8; font-style: italic\">white_piece_list</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8; font-style: italic\">grid_size</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8; font-style: italic\">state</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 检查棋子在哪个格子内</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    grid_status</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> black_piece_outside_list</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> white_piece_outside_list </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">check_pieces_in_grids</span><span style=\"color: #89DDFF\">(</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                            chessboard_block_list</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                            black_piece_list</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                            white_piece_list</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                            grid_size</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 将棋盘状态映射为棋盘</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> state </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">map_board_state</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">board</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            state_mapping </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">empty</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">black</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">white</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[[</span><span style=\"color: #BABED8\">state_mapping</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">cell</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> cell </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> row</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> row </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        mapped_board </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">map_board_state</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">grid_status</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> mapped_board</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">map_board_state</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">board</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            state_mapping </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">empty</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">black</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">white</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[[</span><span style=\"color: #BABED8\">state_mapping</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">cell</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> cell </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> row</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> row </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> board</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        mapped_board </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">map_board_state</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">grid_status</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> mapped_board</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">play_chess</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">now_board</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8; font-style: italic\">chessboard_grid_world_list</span><span style=\"color: #89DDFF\">=None,</span><span style=\"color: #BABED8; font-style: italic\">black_piece_world_list</span><span style=\"color: #89DDFF\">=None,</span><span style=\"color: #BABED8; font-style: italic\">white_piece_world_list</span><span style=\"color: #89DDFF\">=None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">serial_comm</span><span style=\"color: #89DDFF\">=None,</span><span style=\"color: #BABED8; font-style: italic\">k_flag</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #C792EA\">global</span><span style=\"color: #BABED8\"> last_board</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    row</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">col </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span><span style=\"color: #BABED8\">      </span><span style=\"color: #676E95; font-style: italic\">##第六问判断棋子是否变化</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> j </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> now_board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">i</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">j</span><span style=\"color: #89DDFF\">]-</span><span style=\"color: #BABED8\">last_board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">i</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">j</span><span style=\"color: #89DDFF\">]&gt;</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        row</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">col </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> i</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\">j</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #89DDFF; font-style: italic\">elif</span><span style=\"color: #BABED8\"> now_board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">i</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">j</span><span style=\"color: #89DDFF\">]-</span><span style=\"color: #BABED8\">last_board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">i</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">j</span><span style=\"color: #89DDFF\">]&lt;-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">请不要拿走</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">)+</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">j</span><span style=\"color: #89DDFF\">)+</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">黑棋子,请放回去</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        k_flag </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        code </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> i</span><span style=\"color: #89DDFF\">*</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\">j</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #89DDFF; font-style: italic\">elif</span><span style=\"color: #BABED8\"> now_board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">i</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">j</span><span style=\"color: #89DDFF\">]-</span><span style=\"color: #BABED8\">last_board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">i</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">j</span><span style=\"color: #89DDFF\">]&lt;</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        k_flag </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">请不要拿走</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">)+</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">j</span><span style=\"color: #89DDFF\">)+</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">白棋子,请放回去</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        code </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> i</span><span style=\"color: #89DDFF\">*</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\">j</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> k_flag </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\">     </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        last_board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">col</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> PLAYER_O     </span><span style=\"color: #676E95; font-style: italic\">##棋子被放置完之后记录上一步是玩家下的</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">对手完成：</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">row</span><span style=\"color: #89DDFF\">)+</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">col</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">check_winner</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">last_board</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">last_board</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">玩家 O 胜利!</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            k_flag </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">is_board_full</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">last_board</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">last_board</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">平局!</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            k_flag </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> k_flag</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\">##如果标志位为1则继续此回合</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 机器回合</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            row</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> col </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">best_move</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">last_board</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\">##判断最佳决策</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">机器的回合:</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">row</span><span style=\"color: #89DDFF\">)+</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">col</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> serial_comm</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">turn4_flag</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                black_piece_world_interger_x</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> black_piece_world_decimal_x </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">split_float_number_to_str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">black_piece_world_list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]/</span><span style=\"color: #F78C6C\">10.0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                black_piece_world_interger_y</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> black_piece_world_decimal_y </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">split_float_number_to_str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">black_piece_world_list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]/</span><span style=\"color: #F78C6C\">10.0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                message_piece </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">(*</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> black_piece_world_interger_y </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> black_piece_world_decimal_y </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> black_piece_world_interger_x </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> black_piece_world_decimal_x </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">)</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                serial_comm</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">serial_port</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">write</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">message_piece</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">encode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">utf-8</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">))</span><span style=\"color: #BABED8\">       </span><span style=\"color: #676E95; font-style: italic\">##等待机器将棋子放置完毕</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">elif</span><span style=\"color: #BABED8\"> serial_comm</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">turn5_flag</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                white_piece_world_interger_x</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> white_piece_world_decimal_x </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">split_float_number_to_str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">white_piece_world_list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]/</span><span style=\"color: #F78C6C\">10.0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                white_piece_world_interger_y</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> white_piece_world_decimal_y </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">split_float_number_to_str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">white_piece_world_list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]/</span><span style=\"color: #F78C6C\">10.0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                message_piece </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">(*</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> white_piece_world_interger_y </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> white_piece_world_decimal_y </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> white_piece_world_interger_x </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> white_piece_world_decimal_x </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">)</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                serial_comm</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">serial_port</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">write</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">message_piece</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">encode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">utf-8</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">))</span><span style=\"color: #BABED8\">       </span><span style=\"color: #676E95; font-style: italic\">##等待机器将棋子放置完毕</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            chessboard_grid_world_interger_x</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> chessboard_grid_world_decimal_x </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">split_float_number_to_str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">chessboard_grid_world_list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">row</span><span style=\"color: #89DDFF\">*</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\">col</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]/</span><span style=\"color: #F78C6C\">10.0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            chessboard_grid_world_interger_y</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> chessboard_grid_world_decimal_y </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">split_float_number_to_str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">chessboard_grid_world_list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">row</span><span style=\"color: #89DDFF\">*</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\">col</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]/</span><span style=\"color: #F78C6C\">10.0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            message </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">(*</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> chessboard_grid_world_interger_y </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> chessboard_grid_world_decimal_y </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> chessboard_grid_world_interger_x </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> chessboard_grid_world_decimal_x </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">)</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            serial_comm</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">serial_port</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">write</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">message</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">encode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">utf-8</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">))</span><span style=\"color: #BABED8\">       </span><span style=\"color: #676E95; font-style: italic\">##等待机器将棋子放置完毕</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">机器完成:</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\">##记录上一步机器下的位置</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            last_board</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">row</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">col</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> PLAYER_X</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\">##判断游戏是否结束</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">check_winner</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">last_board</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">last_board</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">机器 胜利!</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">is_board_full</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">last_board</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">last_board</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">平局!</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#################################################################################################</span></span>\n<span class=\"line\"></span></code></pre></div></p>\n</details>\n<h1 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h1><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>四天三夜的电赛，人要颠了，好悬没把我攒昏过去。<br>总算搞完电赛的总结了~~</p>\n</div>\n","feature":false,"text":"前言本篇blog是本人在打2024电赛E题学习到的相关知识的整理，由于我们选择的方案是深度数据和RGB数据融合的方法来判断棋子的位置。不同于大多数人选择的ope...","permalink":"/post/三子棋对弈装置-视觉部分","photos":[],"count_time":{"symbolsCount":"37k","symbolsTime":"33 mins."},"categories":[{"name":"Electronic","slug":"Electronic","count":9,"path":"api/categories/Electronic.json"}],"tags":[{"name":"ComputerVision","slug":"ComputerVision","count":3,"path":"api/tags/ComputerVision.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%A1%AC%E4%BB%B6%E7%BB%84%E6%88%90\"><span class=\"toc-text\">硬件组成</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%BD%AF%E4%BB%B6%E9%83%A8%E5%88%86\"><span class=\"toc-text\">软件部分</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E6%B5%81%E8%8E%B7%E5%8F%96\"><span class=\"toc-text\">数据流获取</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%8E%B7%E5%8F%96%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">获取思路</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">代码实现</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A\"><span class=\"toc-text\">相机标定</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%A0%87%E5%AE%9A%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">标定思路</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9D%90%E6%A0%87%E7%B3%BB%E6%98%A0%E5%B0%84\"><span class=\"toc-text\">坐标系映射</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%8E%9F%E7%90%86%E5%85%AC%E5%BC%8F\"><span class=\"toc-text\">原理公式</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1\"><span class=\"toc-text\">代码实现</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%A3%8B%E7%9B%98%E6%A3%80%E6%B5%8B\"><span class=\"toc-text\">棋盘检测</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%A3%80%E6%B5%8B%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">检测思路</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-2\"><span class=\"toc-text\">代码实现</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%A3%8B%E5%AD%90%E6%A3%80%E6%B5%8B\"><span class=\"toc-text\">棋子检测</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3DV%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">3DV方法</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">实现思路</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%BB%85%E4%BB%A3%E7%A0%81%E5%9D%97%EF%BC%89\"><span class=\"toc-text\">代码实现（仅代码块）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2DV%E6%96%B9%E6%B3%95\"><span class=\"toc-text\">2DV方法</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF-1\"><span class=\"toc-text\">实现思路</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-3\"><span class=\"toc-text\">代码实现</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1\"><span class=\"toc-text\">串口通信</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF-2\"><span class=\"toc-text\">实现思路</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-4\"><span class=\"toc-text\">代码实现</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%85%B6%E4%BB%96\"><span class=\"toc-text\">其他</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%90%8E%E8%AE%B0\"><span class=\"toc-text\">后记</span></a></li></ol>","author":{"name":"Yesord","slug":"blog-author","avatar":"/img/avatar/Flametail.gif","link":"/","description":"猫军阀军校的一个四年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top/about/"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"},"Travelling":{"icon":"/img/train.svg","link":"https://www.travellings.cn/go.html"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"朴素贝叶斯-邮件分类编程实践","uid":"e7674ca755d44195295fe130df18e24b","slug":"朴素贝叶斯-邮件分类编程实践","date":"2024-10-06T14:34:15.000Z","updated":"2024-11-20T13:49:07.705Z","comments":true,"path":"api/articles/朴素贝叶斯-邮件分类编程实践.json","keywords":null,"cover":"https://s2.loli.net/2024/10/06/jxrsuIMUXFCn5c9.jpg","text":"前言本项目是基于朴素贝叶斯算法的侮辱性和非侮辱性邮件分类，使用的编程语言是python，是笔者在校系统性学习机器学习的课程小项目。 项目前置python 版本要...","permalink":"/post/朴素贝叶斯-邮件分类编程实践","photos":[],"count_time":{"symbolsCount":"9k","symbolsTime":"8 mins."},"categories":[{"name":"MashineLearning","slug":"MashineLearning","count":3,"path":"api/categories/MashineLearning.json"}],"tags":[{"name":"python","slug":"python","count":5,"path":"api/tags/python.json"}],"author":{"name":"Yesord","slug":"blog-author","avatar":"/img/avatar/Flametail.gif","link":"/","description":"猫军阀军校的一个四年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top/about/"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"},"Travelling":{"icon":"/img/train.svg","link":"https://www.travellings.cn/go.html"}}}}},"next_post":{"title":"树莓派数字识别——openCV方法","uid":"71bced55db8d61b5404a5480e19d78af","slug":"树莓派数字识别——openCV方法","date":"2024-07-22T15:50:17.000Z","updated":"2025-07-21T14:09:02.907Z","comments":true,"path":"api/articles/树莓派数字识别——openCV方法.json","keywords":null,"cover":"https://s2.loli.net/2024/07/22/jvEhAONaoZWue6P.jpg","text":"前言本项目是树莓派识别数字的小例程电赛备赛时写的，实现对1-8的数字识别并与下位机通信控制小车进行运动 项目前置python 版本要求 TIP python>=...","permalink":"/post/树莓派数字识别——openCV方法","photos":[],"count_time":{"symbolsCount":"7.2k","symbolsTime":"7 mins."},"categories":[{"name":"MashineLearning","slug":"MashineLearning","count":3,"path":"api/categories/MashineLearning.json"}],"tags":[{"name":"python","slug":"python","count":5,"path":"api/tags/python.json"}],"author":{"name":"Yesord","slug":"blog-author","avatar":"/img/avatar/Flametail.gif","link":"/","description":"猫军阀军校的一个四年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top/about/"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"},"Travelling":{"icon":"/img/train.svg","link":"https://www.travellings.cn/go.html"}}}}}}