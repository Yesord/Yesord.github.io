{"title":"朴素贝叶斯-邮件分类编程实践","uid":"e7674ca755d44195295fe130df18e24b","slug":"朴素贝叶斯-邮件分类编程实践","date":"2024-10-06T14:34:15.000Z","updated":"2024-11-04T05:31:50.253Z","comments":true,"path":"api/articles/朴素贝叶斯-邮件分类编程实践.json","keywords":null,"cover":"https://s2.loli.net/2024/10/06/jxrsuIMUXFCn5c9.jpg","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>本项目是基于朴素贝叶斯算法的侮辱性和非侮辱性邮件分类，使用的编程语言是python，是笔者在校系统性学习机器学习的课程小项目。</p>\n<h1 id=\"项目前置\"><a href=\"#项目前置\" class=\"headerlink\" title=\"项目前置\"></a>项目前置</h1><h2 id=\"python-版本要求\"><a href=\"#python-版本要求\" class=\"headerlink\" title=\"python 版本要求\"></a>python 版本要求</h2><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p><p>python&gt;&#x3D;3.10</p>\n</p>\n</div>\n<h2 id=\"库依赖要求\"><a href=\"#库依赖要求\" class=\"headerlink\" title=\"库依赖要求\"></a>库依赖要求</h2><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>数据处理</p>\n<p>numpy &lt;&#x3D; 1.26.4<br>pandas</p>\n</div>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>Google API</p>\n<p>google-auth-oauthlib<br>google-auth-httplib2<br>google-api-python-client</p>\n</div>\n<h1 id=\"实现过程\"><a href=\"#实现过程\" class=\"headerlink\" title=\"实现过程\"></a>实现过程</h1><h2 id=\"工程框架\"><a href=\"#工程框架\" class=\"headerlink\" title=\"工程框架\"></a>工程框架</h2><p><img src=\"https://s2.loli.net/2024/10/06/zPHyjZka47L8epl.png\" alt=\" 2024-10-06 132052.png\"></p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p><strong>App</strong>:存放用户代码，包括训练脚本train和测试脚本test<br><strong>data</strong>:存放数据文件，包括数据集、OAuth登录令牌<br><strong>utils</strong>:存放工具集，包括gmail工具、数据准备工具、朴素贝叶斯类<br><strong>model</strong>:存放模型参数文件，贝叶斯模型参数\n</div>\n<p>本项目的工程文件已上传<a href=\"https://github.com/Yesord/NB_gmail_auto_classification\">GitHub</a></p>\n<h2 id=\"朴素贝叶斯类实现\"><a href=\"#朴素贝叶斯类实现\" class=\"headerlink\" title=\"朴素贝叶斯类实现\"></a>朴素贝叶斯类实现</h2><p>朴素贝叶斯算法基于贝叶斯定理，通过计算先验概率和后验概率来进行分类。在处理文本数据时，将邮件内容中的每个词视为特征，利用频率来估计条件概率。这种方法简单但有效，尤其适合文本分类任务。</p>\n<p><img src=\"https://s2.loli.net/2024/10/06/7OJL9tqdSNjXh3l.png\" alt=\" 2024-10-06 132543.png\"></p>\n<h2 id=\"详细公式\"><a href=\"#详细公式\" class=\"headerlink\" title=\"详细公式\"></a>详细公式</h2><ol>\n<li>计算侮辱邮件的<strong>先验概率</strong><br><img src=\"https://s2.loli.net/2024/10/06/NugEsozV13JDhOM.png\" alt=\" 2024-10-06 151304.png\"></li>\n<li>计算侮辱邮件条件下每个词的<strong>后验概率</strong><br><img src=\"https://s2.loli.net/2024/10/06/cow29KXWFaATIGE.png\" alt=\" 2024-10-06 151336.png\"></li>\n<li>计算得分<br><img src=\"https://s2.loli.net/2024/10/06/yXLScx7BuoHO5FZ.png\" alt=\" 2024-10-06 151343.png\"></li>\n<li>计算准确率<br><img src=\"https://s2.loli.net/2024/10/06/APHE582nLbU6N4j.png\" alt=\" 2024-10-06 151352.png\"></li>\n</ol>\n<h2 id=\"训练\"><a href=\"#训练\" class=\"headerlink\" title=\"训练\"></a>训练</h2><h3 id=\"训练步骤\"><a href=\"#训练步骤\" class=\"headerlink\" title=\"训练步骤\"></a>训练步骤</h3><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p><p><strong>STEP1</strong>: 对分类器进行初始化，将每个类别的先验概率、存储每个类别下每个词的条件概率、词汇表、侮辱非侮辱类别标签进行初始化。<br><strong>STEP2</strong>: 遍历所有的邮件，将侮辱邮件的先验概率计算出来。<br><strong>STEP3</strong>: 根据邮件的词语使用，将词语记录到词库之中，并对每个词出现的频率进行统计得到训练集侮辱或非侮辱邮件条件下每个词出现的数量。<br><strong>STEP4</strong>: 得到每个词在侮辱或非侮辱邮件条件下的后验概率。<br><strong>STEP5</strong>: 所有邮件遍历完成之后保存模型参数。</p>\n</p>\n</div>\n<h3 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">train</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178; font-style: italic\">self</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">training_set</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 训练分类器</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        class_counts </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;&#125;</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 存储每个类别的文档数量</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> doc</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> label </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> training_set</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> label </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">in</span><span style=\"color: #BABED8\"> class_counts</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                class_counts</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">label</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            class_counts</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">label</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> word </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> doc</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> word </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">in</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">vocabulary</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">vocabulary</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F07178\">word</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">spam</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">ham</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> label </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">0</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 假设 &#39;0&#39; 表示垃圾邮件</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">vocabulary</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F07178\">word</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">spam</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 假设 &#39;1&#39; 表示非垃圾邮件</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">vocabulary</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F07178\">word</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">ham</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">class_labels</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">list</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">class_counts</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">keys</span><span style=\"color: #89DDFF\">())</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 获取所有类别标签</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        num_docs </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">training_set</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 总文档数量</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> label</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> count </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> class_counts</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">items</span><span style=\"color: #89DDFF\">():</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">class_priors</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F07178\">label</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> count </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> num_docs  </span><span style=\"color: #676E95; font-style: italic\"># 计算先验概率</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 计算后验概率</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        word_counts </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">label</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;&#125;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> label </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">class_labels</span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 初始化词频统计</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> word</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> counts </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">vocabulary</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">items</span><span style=\"color: #89DDFF\">():</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            word_counts</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">0</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">word</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> counts</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">spam</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            word_counts</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">word</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> counts</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">ham</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> label </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">class_labels</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            total_count </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">sum</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">word_counts</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">label</span><span style=\"color: #89DDFF\">].</span><span style=\"color: #82AAFF\">values</span><span style=\"color: #89DDFF\">())</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 计算总词数</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">conditional_prob</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F07178\">label</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> word </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">vocabulary</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                count </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> word_counts</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">label</span><span style=\"color: #89DDFF\">].</span><span style=\"color: #82AAFF\">get</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">word</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #676E95; font-style: italic\"># 使用拉普拉斯平滑</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">conditional_prob</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F07178\">label</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #BABED8\">word</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">count </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">alpha</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">total_count </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">alpha</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">vocabulary</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">save_model</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">model_path</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">训练完成.</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span></code></pre></div><h2 id=\"预测\"><a href=\"#预测\" class=\"headerlink\" title=\"预测\"></a>预测</h2><h3 id=\"预测步骤\"><a href=\"#预测步骤\" class=\"headerlink\" title=\"预测步骤\"></a>预测步骤</h3><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p><strong>STEP1</strong>: 获取训练得到的先验概率。<br><strong>STEP2</strong>: 遍历侮辱与非侮辱条件下的每个词，获得其后验概率，并与先验结合得到得分。<br><strong>STEP3</strong>: 根据得分结果，对邮件是否为侮辱邮件进行分类。</p>\n</div>\n<h3 id=\"代码实现-1\"><a href=\"#代码实现-1\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">predict</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178; font-style: italic\">self</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">docs</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 预测文档的类别</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        predictions </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> doc </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> docs</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\">     </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            scores </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">label</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">log</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">class_priors</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F07178\">label</span><span style=\"color: #89DDFF\">])</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> label </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">class_labels</span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> label </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">class_labels</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> word </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> doc</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> word </span><span style=\"color: #89DDFF\">in</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">vocabulary</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        scores</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">label</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">log</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">conditional_prob</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F07178\">label</span><span style=\"color: #89DDFF\">][</span><span style=\"color: #82AAFF\">word</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #676E95; font-style: italic\"># 对于没见过的词，使用拉普拉斯平滑</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        scores</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">label</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">log</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">alpha</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">alpha</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #82AAFF\"> len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">vocabulary</span><span style=\"color: #89DDFF\">)))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 将对数概率转换为实际概率</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            max_log_score </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">max</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">scores</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">values</span><span style=\"color: #89DDFF\">())</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            exp_scores </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">label</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">exp</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">score </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #82AAFF\"> max_log_score</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> label</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> score </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> scores</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">items</span><span style=\"color: #89DDFF\">()&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            total_exp_scores </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">sum</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">exp_scores</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">values</span><span style=\"color: #89DDFF\">())</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            probabilities </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\">label</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> exp_score </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> total_exp_scores </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> label</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> exp_score </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> exp_scores</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">items</span><span style=\"color: #89DDFF\">()&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            prediction </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">max</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">probabilities</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">key</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">scores</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">get</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 选择概率最大的类别作为预测结果</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            predictions</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">prediction</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> predictions</span></span></code></pre></div><h2 id=\"评估\"><a href=\"#评估\" class=\"headerlink\" title=\"评估\"></a>评估</h2><h3 id=\"评估步骤\"><a href=\"#评估步骤\" class=\"headerlink\" title=\"评估步骤\"></a>评估步骤</h3><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p><strong>STEP1</strong>: 对测试集进行预测。<br><strong>STEP2</strong>: 计算准确率。</p>\n</div>\n<h3 id=\"代码实现-2\"><a href=\"#代码实现-2\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">evaluate</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178; font-style: italic\">self</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">test_set</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 评估分类器的性能</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        predictions </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> self</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">predict</span><span style=\"color: #89DDFF\">([</span><span style=\"color: #82AAFF\">doc </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #82AAFF\"> doc</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> label </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #82AAFF\"> test_set</span><span style=\"color: #89DDFF\">])</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 对测试集进行预测</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        correct </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">sum</span><span style=\"color: #89DDFF\">([</span><span style=\"color: #82AAFF\">label </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #82AAFF\"> pred </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">doc</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> label</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> pred </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #82AAFF\"> zip</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">test_set</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> predictions</span><span style=\"color: #89DDFF\">)])</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 计算正确预测的数量</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> correct </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">test_set</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 返回准确率</span></span></code></pre></div><h2 id=\"数据处理工具实现\"><a href=\"#数据处理工具实现\" class=\"headerlink\" title=\"数据处理工具实现\"></a>数据处理工具实现</h2><p>在处理邮件数据时，数据的清洗和预处理至关重要。通过将邮件内容拆分为标签和文本，并进一步拆分为词，能够有效地构建训练集和测试集，为后续的模型训练提供基础</p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>我们使用的数据集：<br>训练集为<strong>spam_train.txt</strong>，包含5000封邮件（txt 5000行）；<br>测试集为<strong>spam_test.txt</strong>（txt 1000行），包含1000封邮件，其中侮辱类邮件行首用0标识，非侮辱类邮件行首用1标识。</p>\n\n</div>\n<p>首先，根据提供的数据集格式为.txt，同时可以得到数据集内部数据的格式为<br><img src=\"https://s2.loli.net/2024/10/06/3YipcwvuGCrsgDW.png\" alt=\" 2024-10-06 151950.png\"><br><strong>label</strong>为<strong>0</strong>表示<strong>侮辱邮件</strong>，<strong>label</strong>为<strong>1</strong>表示<strong>非侮辱邮件</strong>，<strong>Text</strong>每个词之间以<strong>空格</strong>隔开。</p>\n<h3 id=\"处理步骤\"><a href=\"#处理步骤\" class=\"headerlink\" title=\"处理步骤\"></a>处理步骤</h3><p>因此处理步骤可分为以下4步</p>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p><strong>STEP1</strong>: 读取数据集的.txt的每一行<br><strong>STEP2</strong>: 检索第一个空格，将label和Text拆分，label存入标签列表里。<br><strong>STEP3</strong>: 遍历剩余的每个空格，将Text里的词进行拆分，将词存入数据列表里。<br><strong>STEP4</strong>: 遍历完每一行之后输出标签列表和数据列表。</p>\n</div>\n<p>注：标签列表存的是数据集每封邮件是否是侮辱邮件的标签，数据列表存的是数据集每封邮件的内容，是以每邮件每词进行拆分的二维列表。</p>\n<h3 id=\"代码实现-3\"><a href=\"#代码实现-3\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">load_data</span><span style=\"color: #89DDFF\">():</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">try</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        train_labels</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> train_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">_split_data_form_txt</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">train_data_path</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        test_labels</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> test_data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">_split_data_form_txt</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">test_data_path</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">FileNotFoundError</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">The data files are not found. Please check the data directory.</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> train_labels</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> train_data</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> test_labels</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> test_data</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">_split_data_form_txt</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">data_path</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    labels </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    data </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">with</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">open</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">data_path</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">r</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">encoding</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">utf-8</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> file</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 读取数据</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        lines </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> file</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">readlines</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> line </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> lines</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        split_line </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> line</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">strip</span><span style=\"color: #89DDFF\">().</span><span style=\"color: #82AAFF\">split</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        labels</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">split_line</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        data</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">split_line</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">].</span><span style=\"color: #82AAFF\">split</span><span style=\"color: #89DDFF\">())</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> labels</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> data</span></span></code></pre></div><h2 id=\"Gmail工具实现\"><a href=\"#Gmail工具实现\" class=\"headerlink\" title=\"Gmail工具实现\"></a>Gmail工具实现</h2><p>在访问 Gmail API 时，由于需要设置 OAuth2.0 认证以及代理的使用，我遇到了一些配置上的困难。通过查阅文档和进行调试，最终成功实现了邮件的读取和分类</p>\n<p><img src=\"https://s2.loli.net/2024/10/06/EVUOC5aiTlWhbXL.png\" alt=\" 2024-10-06 013453.png\"></p>\n<h3 id=\"实现思路\"><a href=\"#实现思路\" class=\"headerlink\" title=\"实现思路\"></a>实现思路</h3><p>首先在Google Cloud上创建项目</p>\n<details class=\"custom-details\">\n<summary>Details</summary>\n<p><img src=\"https://s2.loli.net/2024/10/06/xPsX7l13ASW82Cc.png\" alt=\" 2024-10-04 214011.png\"><br><img src=\"https://s2.loli.net/2024/10/06/dSkDY91lAUOmtfJ.png\" alt=\" 2024-10-04 214104.png\">\n</details>\n<p>并开启Gmail API的调用权限与服务</p>\n<details class=\"custom-details\">\n<summary>Details</summary>\n<p><p><img src=\"https://s2.loli.net/2024/10/06/r1O2w4naZkIyUxJ.png\" alt=\" 2024-10-04 214120.png\"><br><img src=\"https://s2.loli.net/2024/10/06/Z92ImpXiFs6JrlO.png\" alt=\" 2024-10-04 214146.png\"></p>\n</p>\n</details>\n<p>将OAuth2.0客户端ID密钥等详细信息保存到本地pickle文件，并通过这些信息连接到Google Cloud上的项目，开始调用Gmail API，对Gmail邮件进行读取等操作。</p>\n<details class=\"custom-details\">\n<summary>客户端打开如图</summary>\n<p><img src=\"https://s2.loli.net/2024/10/06/W4HbZ2rcR5und3S.png\" alt=\" 2024-10-06 152633.png\"></p>\n\n</details>\n<h3 id=\"部分代码\"><a href=\"#部分代码\" class=\"headerlink\" title=\"部分代码\"></a>部分代码</h3><div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> pickle</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> google_auth_oauthlib</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">flow </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> InstalledAppFlow</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> googleapiclient</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">discovery </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> build</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> google</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">auth</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">transport</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">requests </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> Request</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> email</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">mime</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">text </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> MIMEText</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">#如果修改了这些作用域，删除token.pickle文件。</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">SCOPES </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">https://www.googleapis.com/auth/gmail.modify</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 设置代理 需要设置不然中国大陆无法访问google邮箱</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">environ</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">HTTP_PROXY</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">http://127.0.0.1:7890</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">environ</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">HTTPS_PROXY</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">http://127.0.0.1:7890</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">get_gmail_service</span><span style=\"color: #89DDFF\">():</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    creds </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># token.pickle文件存储了用户的访问和刷新令牌</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">exists</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">token_path</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">with</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">open</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">token_path</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">rb</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> token</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            creds </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> pickle</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">load</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">token</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Loaded token</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 如果没有有效的凭证，让用户登录</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> creds </span><span style=\"color: #89DDFF\">or</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> creds</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">valid</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> creds </span><span style=\"color: #89DDFF\">and</span><span style=\"color: #BABED8\"> creds</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">expired</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">and</span><span style=\"color: #BABED8\"> creds</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">refresh_token</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            creds</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">refresh</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">Request</span><span style=\"color: #89DDFF\">())</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Refreshed token</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            flow </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> InstalledAppFlow</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">from_client_secrets_file</span><span style=\"color: #89DDFF\">(</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                json_path</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> SCOPES</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            creds </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> flow</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">run_local_server</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">port</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">12345</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">New token</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 保存凭证以供下次运行使用</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">with</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">open</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">token_path</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">wb</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> token</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            pickle</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dump</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">creds</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> token</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">read_messages</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">service</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">user_id</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">me</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">label_ids</span><span style=\"color: #89DDFF\">=[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">INBOX</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">max_results</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">10</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">is_print</span><span style=\"color: #89DDFF\">=False):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">try</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        msg_list </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        messages </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> service</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">users</span><span style=\"color: #89DDFF\">().</span><span style=\"color: #82AAFF\">messages</span><span style=\"color: #89DDFF\">().</span><span style=\"color: #82AAFF\">list</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">userId</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">user_id</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                                                   </span><span style=\"color: #BABED8; font-style: italic\">labelIds</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">label_ids</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">                                                   </span><span style=\"color: #BABED8; font-style: italic\">maxResults</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">max_results</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #82AAFF\">execute</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> message </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> messages</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">messages</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            msg </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> service</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">users</span><span style=\"color: #89DDFF\">().</span><span style=\"color: #82AAFF\">messages</span><span style=\"color: #89DDFF\">().</span><span style=\"color: #82AAFF\">get</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">userId</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">user_id</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">id</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">message</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">id</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]).</span><span style=\"color: #82AAFF\">execute</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> is_print</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;Subject: </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">_get_subject</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">msg</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;From: </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">_get_sender</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">msg</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;Snippet: </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">msg</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">snippet</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #BABED8\">\\n</span><span style=\"color: #C3E88D\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            msg_list</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">msg</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> msg_list</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Exception</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> error</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&#39;An error occurred: </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">error</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">send_message</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">service</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">user_id</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">subject</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">body</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">to</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    message </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">MIMEText</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">body</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    message</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">to</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> to</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    message</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">subject</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> subject</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    raw_message </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> base64</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">urlsafe_b64encode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">message</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">as_bytes</span><span style=\"color: #89DDFF\">()).</span><span style=\"color: #82AAFF\">decode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">utf-8</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">try</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        message </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> service</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">users</span><span style=\"color: #89DDFF\">().</span><span style=\"color: #82AAFF\">messages</span><span style=\"color: #89DDFF\">().</span><span style=\"color: #82AAFF\">send</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">userId</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">user_id</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">body</span><span style=\"color: #89DDFF\">=&#123;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">raw</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #82AAFF\"> raw_message</span><span style=\"color: #89DDFF\">&#125;).</span><span style=\"color: #82AAFF\">execute</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;Message Id: </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">message</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">id</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> message</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Exception</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> error</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&#39;An error occurred: </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">error</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">None</span></span></code></pre></div><h1 id=\"测试结果\"><a href=\"#测试结果\" class=\"headerlink\" title=\"测试结果\"></a>测试结果</h1><h2 id=\"测试集准确率\"><a href=\"#测试集准确率\" class=\"headerlink\" title=\"测试集准确率\"></a>测试集准确率</h2><p>运行<strong>train.py</strong>脚本可以得到测试集的准确率为 <strong>97.4%</strong> 。说明该朴素贝叶斯分类器在测试集上的分类表现良好，能够正确分类大多数测试样本。</p>\n<h2 id=\"实际邮件的预测效果\"><a href=\"#实际邮件的预测效果\" class=\"headerlink\" title=\"实际邮件的预测效果\"></a>实际邮件的预测效果</h2><p>手动输入文本</p>\n<details class=\"custom-details\">\n<summary>Details</summary>\n<p><p><img src=\"https://s2.loli.net/2024/10/06/6HXOh8g4QTnUjEF.png\" alt=\" 2024-10-06 134754.png\"><br><img src=\"https://s2.loli.net/2024/10/06/dchTfroEq2C5R46.png\" alt=\" 2024-10-06 134858.png\"><br><img src=\"https://s2.loli.net/2024/10/06/4snGkbvSAdTBu6E.png\" alt=\" 2024-10-06 134728.png\"></p>\n</p>\n</details>\n<p>先验概率是从模型计算分数并进行归一化得到的。该朴素贝叶斯分类器能简单的根据邮件的内容（例如“love”“stupid”之类的词）进行侮辱邮件的分类。简单邮件的分类表现不错。</p>\n<h2 id=\"从Gmail获取最近的一封邮件\"><a href=\"#从Gmail获取最近的一封邮件\" class=\"headerlink\" title=\"从Gmail获取最近的一封邮件\"></a>从Gmail获取最近的一封邮件</h2><details class=\"custom-details\">\n<summary>Details</summary>\n<p><img src=\"https://s2.loli.net/2024/10/06/Ukgc9IZveF6W3Bl.png\" alt=\" 2024-10-06 135334.png\"><br><img src=\"https://s2.loli.net/2024/10/06/ePY4VhG81ZF9gEy.png\" alt=\" 2024-10-06 134948.png\"></p>\n</details>\n<p>运行<strong>test.py</strong>脚本能有效地读出测试gmail邮箱中邮件的信息并进行是否为侮辱邮件的简单判断。但是实际效果还是不太好，可能是由于数据集数据量或数据质量受限。</p>\n<h1 id=\"心得与体会\"><a href=\"#心得与体会\" class=\"headerlink\" title=\"心得与体会\"></a>心得与体会</h1><h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>在本次项目中，我深入学习和应用了朴素贝叶斯算法进行邮件分类，主要针对侮辱性和非侮辱性邮件的识别。这一过程让我对贝叶斯的基本原理有了更深刻的理解，尤其是在文本分类方面的应用。在未来的学习中，我希望能继续深化对机器学习算法的理解，并尝试更复杂的模型和数据集。</p>\n\n</div>\n<h2 id=\"改进方向\"><a href=\"#改进方向\" class=\"headerlink\" title=\"改进方向\"></a>改进方向</h2><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>在实际应用中，数据集的质量直接影响到模型的效果。虽然使用了5000封邮件进行训练，但数据的多样性和标签的准确性仍需要关注。在特征提取方面，可以使用一些技巧去提取关键词，而不是将所有词都作为词库，这样在关键词上的处理可以提高模型的表现。在之后的学习可以学到更多的机器学习算法，可以尝试使用它们来对比朴素贝叶斯算法的效果，看看是否能进一步提高分类准确率。</p>\n</div>\n","text":"前言本项目是基于朴素贝叶斯算法的侮辱性和非侮辱性邮件分类，使用的编程语言是python，是笔者在校系统性学习机器学习的课程小项目。 项目前置python 版本要...","permalink":"/post/朴素贝叶斯-邮件分类编程实践","photos":[],"count_time":{"symbolsCount":"9k","symbolsTime":"8 mins."},"categories":[{"name":"MashineLearning","slug":"MashineLearning","count":2,"path":"api/categories/MashineLearning.json"}],"tags":[{"name":"python","slug":"python","count":4,"path":"api/tags/python.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%BD%AE\"><span class=\"toc-text\">项目前置</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#python-%E7%89%88%E6%9C%AC%E8%A6%81%E6%B1%82\"><span class=\"toc-text\">python 版本要求</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%BA%93%E4%BE%9D%E8%B5%96%E8%A6%81%E6%B1%82\"><span class=\"toc-text\">库依赖要求</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B\"><span class=\"toc-text\">实现过程</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6\"><span class=\"toc-text\">工程框架</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%B1%BB%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">朴素贝叶斯类实现</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AF%A6%E7%BB%86%E5%85%AC%E5%BC%8F\"><span class=\"toc-text\">详细公式</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AE%AD%E7%BB%83\"><span class=\"toc-text\">训练</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AE%AD%E7%BB%83%E6%AD%A5%E9%AA%A4\"><span class=\"toc-text\">训练步骤</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">代码实现</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%A2%84%E6%B5%8B\"><span class=\"toc-text\">预测</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%A2%84%E6%B5%8B%E6%AD%A5%E9%AA%A4\"><span class=\"toc-text\">预测步骤</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1\"><span class=\"toc-text\">代码实现</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AF%84%E4%BC%B0\"><span class=\"toc-text\">评估</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%AF%84%E4%BC%B0%E6%AD%A5%E9%AA%A4\"><span class=\"toc-text\">评估步骤</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-2\"><span class=\"toc-text\">代码实现</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">数据处理工具实现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A4%84%E7%90%86%E6%AD%A5%E9%AA%A4\"><span class=\"toc-text\">处理步骤</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-3\"><span class=\"toc-text\">代码实现</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Gmail%E5%B7%A5%E5%85%B7%E5%AE%9E%E7%8E%B0\"><span class=\"toc-text\">Gmail工具实现</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">实现思路</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%83%A8%E5%88%86%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">部分代码</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C\"><span class=\"toc-text\">测试结果</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B5%8B%E8%AF%95%E9%9B%86%E5%87%86%E7%A1%AE%E7%8E%87\"><span class=\"toc-text\">测试集准确率</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E9%99%85%E9%82%AE%E4%BB%B6%E7%9A%84%E9%A2%84%E6%B5%8B%E6%95%88%E6%9E%9C\"><span class=\"toc-text\">实际邮件的预测效果</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%8EGmail%E8%8E%B7%E5%8F%96%E6%9C%80%E8%BF%91%E7%9A%84%E4%B8%80%E5%B0%81%E9%82%AE%E4%BB%B6\"><span class=\"toc-text\">从Gmail获取最近的一封邮件</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%BF%83%E5%BE%97%E4%B8%8E%E4%BD%93%E4%BC%9A\"><span class=\"toc-text\">心得与体会</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">总结</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%94%B9%E8%BF%9B%E6%96%B9%E5%90%91\"><span class=\"toc-text\">改进方向</span></a></li></ol></li></ol>","author":{"name":"Yesord","slug":"blog-author","avatar":"https://s2.loli.net/2023/10/17/4GK2m3UkXztog9D.jpg","link":"/","description":"猫军阀军校的一个三年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"Jetson Nano部署Yolo模型笔记","uid":"714f64421d876371e3d936b45ca967be","slug":"Jetson-Nano部署Yolo模型笔记","date":"2024-07-22T15:34:15.000Z","updated":"2024-11-04T05:31:50.249Z","comments":true,"path":"api/articles/Jetson-Nano部署Yolo模型笔记.json","keywords":null,"cover":"https://s2.loli.net/2024/07/22/PyOhiF41qxtnBZK.jpg","text":"前言本人在大二期间就学习了计算机视觉相关的模型搭建、训练和预测。大致了解目标检测的训练流程，却没有去实际在端设备上进行过模型的部署。在准备电赛期间，拿到 jet...","permalink":"/post/Jetson-Nano部署Yolo模型笔记","photos":[],"count_time":{"symbolsCount":"17k","symbolsTime":"15 mins."},"categories":[{"name":"Electronic","slug":"Electronic","count":6,"path":"api/categories/Electronic.json"}],"tags":[{"name":"jetson nano","slug":"jetson-nano","count":1,"path":"api/tags/jetson-nano.json"},{"name":"ComputerVision","slug":"ComputerVision","count":3,"path":"api/tags/ComputerVision.json"}],"author":{"name":"Yesord","slug":"blog-author","avatar":"https://s2.loli.net/2023/10/17/4GK2m3UkXztog9D.jpg","link":"/","description":"猫军阀军校的一个三年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"}}}},"feature":true},"next_post":{"title":"三子棋对弈装置--视觉部分","uid":"46d63a6191ce7c7d772a0f14338f0d34","slug":"三子棋对弈装置-视觉部分","date":"2024-08-12T14:55:02.000Z","updated":"2024-11-04T05:31:50.252Z","comments":true,"path":"api/articles/三子棋对弈装置-视觉部分.json","keywords":null,"cover":"https://s2.loli.net/2024/07/22/9QG8dFxISpaDAq2.jpg","text":"前言本篇blog是本人在打2024电赛E题学习到的相关知识的整理，由于我们选择的方案是深度数据和RGB数据融合的方法来判断棋子的位置。不同于大多数人选择的ope...","permalink":"/post/三子棋对弈装置-视觉部分","photos":[],"count_time":{"symbolsCount":"37k","symbolsTime":"33 mins."},"categories":[{"name":"electronic","slug":"electronic","count":1,"path":"api/categories/electronic.json"}],"tags":[{"name":"ComputerVision","slug":"ComputerVision","count":3,"path":"api/tags/ComputerVision.json"}],"author":{"name":"Yesord","slug":"blog-author","avatar":"https://s2.loli.net/2023/10/17/4GK2m3UkXztog9D.jpg","link":"/","description":"猫军阀军校的一个三年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"}}}},"feature":false}}