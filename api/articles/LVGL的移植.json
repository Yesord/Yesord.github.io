{"title":"LVGL的移植","uid":"507d422f151c505ace4132bc7d4f4fff","slug":"LVGL的移植","date":"2023-10-18T14:26:45.000Z","updated":"2024-11-03T04:51:55.706Z","comments":true,"path":"api/articles/LVGL的移植.json","keywords":null,"cover":"https://s2.loli.net/2023/10/20/vZLkFsEtNA4iqBH.jpg","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>LVGL是一个免费好用的嵌入式GUI库，其控件扁平化，符合当今大众审美，主要应用在一些像智能手表之类的产品之上。前几天刚搞到一块STM32F103RCT6的最小系统板+ST7735S的TFT-LCD（可惜了不是触摸屏QAQ），今咱就来尝试移植一下LVGL到STM32上，整点炫的。</p>\n<h1 id=\"LVGL的移植流程\"><a href=\"#LVGL的移植流程\" class=\"headerlink\" title=\"LVGL的移植流程\"></a>LVGL的移植流程</h1><p>以STM32F103RCT6为例</p>\n<h2 id=\"LVGL源码下载\"><a href=\"#LVGL源码下载\" class=\"headerlink\" title=\"LVGL源码下载\"></a>LVGL源码下载</h2><p>Github仓库地址 <a href=\"https://github.com/lvgl/lvgl\">https://github.com/lvgl/lvgl</a></p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>准备LVGL源码<br>修改lv_conf.h文件，修改条件编译</p>\n<p>删除不必要文件</p>\n<h2 id=\"添加工程文件\"><a href=\"#添加工程文件\" class=\"headerlink\" title=\"添加工程文件\"></a>添加工程文件</h2><h3 id=\"需要添加文件\"><a href=\"#需要添加文件\" class=\"headerlink\" title=\"需要添加文件\"></a>需要添加文件</h3><h3 id=\"需要添加头文件路径\"><a href=\"#需要添加头文件路径\" class=\"headerlink\" title=\"需要添加头文件路径\"></a>需要添加头文件路径</h3><h3 id=\"特殊配置\"><a href=\"#特殊配置\" class=\"headerlink\" title=\"特殊配置\"></a>特殊配置</h3><p>(可选)屏蔽warning</p>\n<h2 id=\"修改工程文件-裸机开发\"><a href=\"#修改工程文件-裸机开发\" class=\"headerlink\" title=\"修改工程文件(裸机开发)\"></a>修改工程文件(裸机开发)</h2><h3 id=\"总体配置\"><a href=\"#总体配置\" class=\"headerlink\" title=\"总体配置\"></a>总体配置</h3><p>修改<strong>lv_conf.h</strong></p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">clang-format</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">off</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#if 1 /*Set it to &quot;1&quot; to enable content*/</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">原先这里是#if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">需改成</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">#if 1</span></span>\n<span class=\"line\"></span></code></pre></div><h3 id=\"添加output设备\"><a href=\"#添加output设备\" class=\"headerlink\" title=\"添加output设备\"></a>添加output设备</h3><p>修改<strong>lv_port_disp_template.h</strong>为<strong>lv_port_disp.h</strong><br>对应的头文件名在对应c文件中也要更改</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*Copy</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">this</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">file</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">as</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">lv_port_disp.h</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">and</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">this</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">value</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">to</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">1</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">to</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">enable</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">content</span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#if 1 //使能lv_port_disp.h</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span></code></pre></div><p>修改<strong>lv_port_disp_template.c</strong></p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">添加自己的屏幕尺寸</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">#define MY_DISP_HOR_RES    128 //水平</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">#define MY_DISP_VER_RES    160 //垂直</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">修改使用的buffer算法（三选一）</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">有详细介绍，可以认为从上到下性能递增，占用内存也递增</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">Example</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">for</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">) </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">/</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lv_disp_draw_buf_t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">draw_buf_dsc_1</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lv_color_t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buf_1[MY_DISP_HOR_RES</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">10</span><span style=\"color: #C3E88D\">]</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\">                          </span><span style=\"color: #FFCB6B\">/*A</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buffer</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">for</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">10</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">rows</span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">lv_disp_draw_buf_init(</span><span style=\"color: #89DDFF\">&amp;</span><span style=\"color: #FFCB6B\">draw_buf_dsc_1,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buf_1,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">NULL,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">MY_DISP_HOR_RES</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">10</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">/*Initialize</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">display</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buffer</span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">/</span><span style=\"color: #BABED8\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">Example</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">for</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #BABED8\">) </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">/</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lv_disp_draw_buf_t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">draw_buf_dsc_2</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lv_color_t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buf_2_1[MY_DISP_HOR_RES</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">10</span><span style=\"color: #C3E88D\">]</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\">                        </span><span style=\"color: #FFCB6B\">/*A</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buffer</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">for</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">10</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">rows</span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lv_color_t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buf_2_2[MY_DISP_HOR_RES</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">10</span><span style=\"color: #C3E88D\">]</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\">                        </span><span style=\"color: #FFCB6B\">/*An</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">other</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buffer</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">for</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">10</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">rows</span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">lv_disp_draw_buf_init</span><span style=\"color: #89DDFF\">(&amp;</span><span style=\"color: #FFCB6B\">draw_buf_dsc_2,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buf_2_1,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buf_2_2,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">MY_DISP_HOR_RES</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">10</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">/*Initialize</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">display</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buffer</span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">/</span><span style=\"color: #BABED8\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">Example</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">for</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #BABED8\">) also set disp_drv.full_refresh = 1 below</span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">/</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lv_disp_draw_buf_t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">draw_buf_dsc_3</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lv_color_t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buf_3_1[MY_DISP_HOR_RES</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">MY_DISP_VER_RES]</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">/*A</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">screen</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">sized</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buffer</span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">lv_color_t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buf_3_2[MY_DISP_HOR_RES</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">MY_DISP_VER_RES]</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">/*Another</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">screen</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">sized</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buffer</span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\">    </span><span style=\"color: #C3E88D\">lv_disp_draw_buf_init</span><span style=\"color: #89DDFF\">(&amp;</span><span style=\"color: #FFCB6B\">draw_buf_dsc_3,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buf_3_1,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buf_3_2,</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\">                          </span><span style=\"color: #C3E88D\">MY_DISP_VER_RES</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">LV_VER_RES_MAX</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #BABED8\">   </span><span style=\"color: #FFCB6B\">/*Initialize</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">display</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buffer</span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">修改</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">disp_init</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">放入自己的屏幕驱动</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*Initialize</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">your</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">display</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">and</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">required</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">peripherals.</span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">disp_init</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">void</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">/*You</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">code</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">here</span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">/</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #82AAFF\">LCD_Init</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">修改</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">disp_flush</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">放入自己屏幕的色块填充程序</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*Flush</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">content</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">of</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">internal</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">buffer</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">specific</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">area</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">on</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">display</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">*You</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">can</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">use</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">DMA</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">or</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">any</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">hardware</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">acceleration</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">to</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">do</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">this</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">operation</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">background</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">but</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">*&#39;lv_disp_flush_ready</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\"> has to be called when finished.*/</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">static void disp_flush(lv_disp_drv_t * disp_drv, const lv_area_t * area, lv_color_t * color_p)</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//    if(disp_flush_enabled) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//        /*The most simple case (but also the slowest) to put all pixels to the screen one-by-one*/</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//        int32_t x;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//        int32_t y;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//        for(y = area-&gt;y1; y &lt;= area-&gt;y2; y++) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//            for(x = area-&gt;x1; x &lt;= area-&gt;x2; x++) &#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//                /*Put a pixel to the display. For example:*/</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//                /*put_px(x, y, *color_p)*/</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//                color_p++;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//            &#125;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//        &#125;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">//    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    LCD_Fill(area-&gt;x1,area-&gt;y1,area-&gt;x2,area-&gt;y2,(uint16_t)color_p);</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    /*IMPORTANT!!!</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">     *Inform the graphics library that you are ready with the flushing*/</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    lv_disp_flush_ready(disp_drv);</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">&#125;</span></span>\n<span class=\"line\"></span></code></pre></div><h3 id=\"添加input设备\"><a href=\"#添加input设备\" class=\"headerlink\" title=\"添加input设备\"></a>添加input设备</h3><p>LVGL支持编码器、按键、触摸屏等输入</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">还没写捏~~</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">产能不足惹~~</span></span>\n<span class=\"line\"></span></code></pre></div><h3 id=\"添加lvgl时基\"><a href=\"#添加lvgl时基\" class=\"headerlink\" title=\"添加lvgl时基\"></a>添加lvgl时基</h3><p>定时器驱动文件加入 <strong>#include”lvgl.h”</strong><br>定时器中断设置1ms中断，放入<strong>lv_tick_inc</strong></p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">TIM3_Handler</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">void</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">&#123;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">//定时器配置1ms中断</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">lv_tick_inc(1</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span></code></pre></div><h2 id=\"测试程序\"><a href=\"#测试程序\" class=\"headerlink\" title=\"测试程序\"></a>测试程序</h2><p>可能无法显示需要去改startup文件的堆栈大小 </p>\n<h2 id=\"FreeRTOS下的移植\"><a href=\"#FreeRTOS下的移植\" class=\"headerlink\" title=\"FreeRTOS下的移植\"></a>FreeRTOS下的移植</h2><p>基本同裸机的配置相差不大，也就需要改个时基，使用FreeRTOS的</p>\n<h3 id=\"时基配置\"><a href=\"#时基配置\" class=\"headerlink\" title=\"时基配置\"></a>时基配置</h3><p><strong>lv_conf.h</strong>中添加自定义时基</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*Use</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">a</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">custom</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">tick</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">source</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">that</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">tells</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">elapsed</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">time</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">milliseconds.</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">*It</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">removes</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">need</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">to</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">manually</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">update</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">the</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">tick</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">with</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">`lv_tick_inc</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #C3E88D\">)*/</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#define LV_TICK_CUSTOM 1 //使能1，默认是0</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#if LV_TICK_CUSTOM</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    </span><span style=\"color: #676E95; font-style: italic\">#define LV_TICK_CUSTOM_INCLUDE &quot;FreeRTOS.h&quot;         /*Header for the system time function*/</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    </span><span style=\"color: #676E95; font-style: italic\">#define LV_TICK_CUSTOM_SYS_TIME_EXPR (xTaskGetTickCount())    /*Expression evaluating to current system time in ms*/</span></span>\n<span class=\"line\"></span></code></pre></div><p>注意该配置与裸机移植的配置<strong>不能兼容</strong>。</p>\n<h1 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h1><p>刚学LVGL，移个植都费劲，库函数也还没理清，路漫漫其修远兮啊。。。</p>\n","text":"前言LVGL是一个免费好用的嵌入式GUI库，其控件扁平化，符合当今大众审美，主要应用在一些像智能手表之类的产品之上。前几天刚搞到一块STM32F103RCT6的...","permalink":"/post/LVGL的移植","photos":[],"count_time":{"symbolsCount":"4k","symbolsTime":"4 mins."},"categories":[{"name":"Embedded","slug":"Embedded","count":4,"path":"api/categories/Embedded.json"}],"tags":[{"name":"TPSW","slug":"TPSW","count":1,"path":"api/tags/TPSW.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#LVGL%E7%9A%84%E7%A7%BB%E6%A4%8D%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">LVGL的移植流程</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#LVGL%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD\"><span class=\"toc-text\">LVGL源码下载</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\"><span class=\"toc-text\">准备工作</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0%E5%B7%A5%E7%A8%8B%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">添加工程文件</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%9C%80%E8%A6%81%E6%B7%BB%E5%8A%A0%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">需要添加文件</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%9C%80%E8%A6%81%E6%B7%BB%E5%8A%A0%E5%A4%B4%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84\"><span class=\"toc-text\">需要添加头文件路径</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%89%B9%E6%AE%8A%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">特殊配置</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9%E5%B7%A5%E7%A8%8B%E6%96%87%E4%BB%B6-%E8%A3%B8%E6%9C%BA%E5%BC%80%E5%8F%91\"><span class=\"toc-text\">修改工程文件(裸机开发)</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%80%BB%E4%BD%93%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">总体配置</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0output%E8%AE%BE%E5%A4%87\"><span class=\"toc-text\">添加output设备</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0input%E8%AE%BE%E5%A4%87\"><span class=\"toc-text\">添加input设备</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%B7%BB%E5%8A%A0lvgl%E6%97%B6%E5%9F%BA\"><span class=\"toc-text\">添加lvgl时基</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F\"><span class=\"toc-text\">测试程序</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#FreeRTOS%E4%B8%8B%E7%9A%84%E7%A7%BB%E6%A4%8D\"><span class=\"toc-text\">FreeRTOS下的移植</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%97%B6%E5%9F%BA%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">时基配置</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%90%8E%E8%AE%B0\"><span class=\"toc-text\">后记</span></a></li></ol>","author":{"name":"Yesord","slug":"blog-author","avatar":"/img/avatar/Flametail.gif","link":"/","description":"猫军阀军校的一个三年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top/about/"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"},"Travelling":{"icon":"/img/train.svg","link":"https://www.travellings.cn/go.html"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"STM32F103RCT6核心板设计","uid":"7742e69e813648d5c85a45d015f995f0","slug":"STM32F103RCT6核心板设计","date":"2023-10-20T13:50:03.000Z","updated":"2024-11-03T04:51:55.708Z","comments":true,"path":"api/articles/STM32F103RCT6核心板设计.json","keywords":null,"cover":"https://s2.loli.net/2023/10/20/NiqwxTIlbRLvh1H.jpg","text":"STM32F103RCT6学习开发用...","permalink":"/post/STM32F103RCT6核心板设计","photos":[],"count_time":{"symbolsCount":"1k","symbolsTime":"1 mins."},"categories":[{"name":"Electronic","slug":"Electronic","count":9,"path":"api/categories/Electronic.json"}],"tags":[{"name":"STM32","slug":"STM32","count":2,"path":"api/tags/STM32.json"}],"author":{"name":"Yesord","slug":"blog-author","avatar":"/img/avatar/Flametail.gif","link":"/","description":"猫军阀军校的一个三年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top/about/"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"},"Travelling":{"icon":"/img/train.svg","link":"https://www.travellings.cn/go.html"}}}},"feature":false},"next_post":{"title":"图片转链接--SM.MS图床","uid":"11caf7d9cf7a688f2728c9360ab7d311","slug":"图片转链接-SM-MS图床","date":"2023-10-17T14:01:58.000Z","updated":"2024-11-03T04:51:55.715Z","comments":true,"path":"api/articles/图片转链接-SM-MS图床.json","keywords":null,"cover":"https://s2.loli.net/2023/10/17/5l32DiwHqy1rhOM.jpg","text":"SM.SM图床网站推荐引言平时大家编写.md文件时肯定有对图片有所苦恼。正常从本机引用的话，跨设备图片就会无法显示，如果调到github仓库里又会比较麻烦。 大...","permalink":"/post/图片转链接-SM-MS图床","photos":[],"count_time":{"symbolsCount":183,"symbolsTime":"1 mins."},"categories":[{"name":"IT","slug":"IT","count":4,"path":"api/categories/IT.json"}],"tags":[{"name":"tool","slug":"tool","count":2,"path":"api/tags/tool.json"}],"author":{"name":"Yesord","slug":"blog-author","avatar":"/img/avatar/Flametail.gif","link":"/","description":"猫军阀军校的一个三年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top/about/"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"},"Travelling":{"icon":"/img/train.svg","link":"https://www.travellings.cn/go.html"}}}}}}