{"title":"Jetson Nano部署Yolo模型笔记","uid":"714f64421d876371e3d936b45ca967be","slug":"Jetson-Nano部署Yolo模型笔记","date":"2024-07-22T15:34:15.000Z","updated":"2024-11-01T01:24:22.352Z","comments":true,"path":"api/articles/Jetson-Nano部署Yolo模型笔记.json","keywords":null,"cover":"https://s2.loli.net/2024/07/22/PyOhiF41qxtnBZK.jpg","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p>本人在大二期间就学习了计算机视觉相关的模型搭建、训练和预测。大致了解目标检测的训练流程，却没有去实际在端设备上进行过模型的部署。在准备电赛期间，拿到 jetson nano 开始玩一玩模型部署，就有了这篇博客。</p>\n<p><img src=\"https://s2.loli.net/2024/07/22/AoBYZEG6m4pd9ID.jpg\" alt=\"d6c653d5d6e978a038602be5322c17b.jpg\"></p>\n<h1 id=\"项目前置\"><a href=\"#项目前置\" class=\"headerlink\" title=\"项目前置\"></a>项目前置</h1><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\"> </p>\n<p>深度模型<br><strong>YOLOv8(pytorch框架)</strong></p>\n<p>深度模型部署框架<br><strong>infer (基于TensorRT和onnx模型的框架)</strong></p>\n\n</div>\n<h1 id=\"项目主体\"><a href=\"#项目主体\" class=\"headerlink\" title=\"项目主体\"></a>项目主体</h1><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\"> </p>\n<p><p>使用YOLOv8对数字进行识别</p>\n</p>\n</div>\n<h2 id=\"整体流程\"><a href=\"#整体流程\" class=\"headerlink\" title=\"整体流程\"></a>整体流程</h2><div class=\"custom-quote danger\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M19.76 5.23C15.84 5.23 12 2 12 2C12 2 8.15996 5.23 4.23996 5.23C4.23996 5.23 1.86996 16.99 12 22C22.13 16.99 19.76 5.23 19.76 5.23Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 16H12\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>电脑上进行YOLOv8模型训练<br>—&gt; 输出.pt模型<br>—&gt; 转换成onnx模型(通用的模型)<br>—&gt; 在infer框架下转换成.engine<br>—&gt; 运行.engine开始运行</p>\n\n</div>\n<h2 id=\"模型训练\"><a href=\"#模型训练\" class=\"headerlink\" title=\"模型训练\"></a>模型训练</h2><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p><p>在PC端或是GPU服务器上进行会比较顺利。</p>\n</p>\n</div>\n<h2 id=\"下载YOLOv8\"><a href=\"#下载YOLOv8\" class=\"headerlink\" title=\"下载YOLOv8\"></a>下载YOLOv8</h2><p><a href=\"https://github.com/ultralytics/ultralytics\">YOLOv8_GitHub库</a></p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 使用命令行</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">git</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">clone</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">https://github.com/ultralytics/ultralytics.git</span></span></code></pre></div><p>python安装ultralytics库（推荐在conda上进行）</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">pip</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">install</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">ultralytics</span></span></code></pre></div><p>安装其他依赖库</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 在ultralytics的仓库里找到requirements.txt,注意当前工作目录（转移到requirements.txt所在目录）</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">pip</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">install</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-r</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">requirements.txt</span></span></code></pre></div><h2 id=\"数据集获取\"><a href=\"#数据集获取\" class=\"headerlink\" title=\"数据集获取\"></a>数据集获取</h2><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>根据最终需要识别的目标，可以去网上找现成的数据集</p>\n</div>\n<details class=\"custom-details\">\n<summary>在这里推荐查找数据集的两个网站</summary>\n<ol>\n<li>Kaggle</li>\n</ol>\n<p><img src=\"https://s2.loli.net/2024/07/22/SpUWXz6diucYOb1.png\" alt=\" 2024-07-22 144430.png\"></p>\n<ol start=\"2\">\n<li>roboflow Universe</li>\n</ol>\n<p><img src=\"https://s2.loli.net/2024/07/22/zVX8fjO7WG2TmxE.png\" alt=\" 2024-07-22 144458.png\"></p>\n\n</details>\n<h2 id=\"数据集采集（可选）\"><a href=\"#数据集采集（可选）\" class=\"headerlink\" title=\"数据集采集（可选）\"></a>数据集采集（可选）</h2><div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>也可以自己去做数据集，像本项目就是自己去采的数据集。</p>\n</div>\n<details class=\"custom-details\">\n<summary>本项目</summary>\n<p>总共400张，通过写opencv的脚本去实现采集。<br><img src=\"https://s2.loli.net/2024/07/22/haGrSRiAvk4wUsW.png\" alt=\" 2024-07-22 154312.png\"></p>\n</details>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>这里提供一个可以通过摄像头去获取图片的脚本<strong>auto_get_img.py</strong></p>\n</div>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> cv2 </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> os</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> osp</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> numpy </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> np</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 保存目录需要自己去设置</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">script_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dirname</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">__file__</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">img_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">script_dir</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">image</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">save_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">img_dir</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">captured_image_dir</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 创建保存目录,如果不存在</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">exists</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">save_dir</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">makedirs</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">save_dir</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;保存目录</span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">save_dir</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">已创建&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;保存目录</span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">save_dir</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">已存在&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 创建视频捕获对象</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cap </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">VideoCapture</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> cap</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">isOpened</span><span style=\"color: #89DDFF\">():</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">无法打开摄像头</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">exit</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">times </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">input</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">请输入需要截取几个图片</span><span style=\"color: #BABED8\">\\n</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">i </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">True:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 读取一帧</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    ret</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cap</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">read</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> ret</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 显示图像</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">imshow</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">frame</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> frame</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 保存图像</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">waitKey</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&amp;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">0x</span><span style=\"color: #F78C6C\">FF</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">ord</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">s</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">):</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 按s保存图片</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">imwrite</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">save_dir </span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;img_</span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">.jpg&quot;</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> frame</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;图像已保存为 img_</span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">.jpg&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            times </span><span style=\"color: #89DDFF\">-=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            i </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">无法读取摄像头图像</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">waitKey</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&amp;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">0x</span><span style=\"color: #F78C6C\">FF</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">ord</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">q</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">or</span><span style=\"color: #BABED8\"> times </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 按q退出</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">break</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 释放摄像头</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cap</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">release</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 关闭所有OpenCV窗口</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">destroyAllWindows</span><span style=\"color: #89DDFF\">()</span></span></code></pre></div><h2 id=\"数据集的标定（可选）\"><a href=\"#数据集的标定（可选）\" class=\"headerlink\" title=\"数据集的标定（可选）\"></a>数据集的标定（可选）</h2><p>本项目使用的是<strong>精灵标注助手</strong>，使用labelme之类的标注工具也是可以的，我们的目的是对数据集图片打标，对我们感兴趣的区域进行标注，画出bondnigbox。我们做的是目标检测detect，只画矩形框即可。</p>\n<details class=\"custom-details\">\n<summary>大致如图</summary>\n<p><img src=\"https://s2.loli.net/2024/07/22/klms7viDcShRgZF.png\" alt=\" 2024-07-22 163813.png\"></p>\n\n</details>\n<h2 id=\"XML转txt-YOLO数据集格式\"><a href=\"#XML转txt-YOLO数据集格式\" class=\"headerlink\" title=\"XML转txt(YOLO数据集格式)\"></a>XML转txt(YOLO数据集格式)</h2><p>XML是labelme标注完之后生成的文件格式，详细可以去google看看。Yolo接受的数据集格式是txt，详细去google。</p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>这里提供一个XML转txt的脚本<strong>xml_to_txt.py</strong></p>\n</div>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#########################</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># xml2txt.py</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#########################</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> xml</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">etree</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">ElementTree</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> ET</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> cv2</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> numpy </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> np</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> os </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> listdir</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">path </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> join</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">classes </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">2</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">3</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">4</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">5</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">6</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">7</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">8</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 写入你做目标检测的物体的分类</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">convert</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">size</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">box</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    dw </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">size</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    dh </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">size</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    x </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">box</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> box</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">])</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2.0</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    y </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">box</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> box</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">])</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2.0</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    w </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> box</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\"> box</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    h </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> box</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\"> box</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    x </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> x </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> dw</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    w </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> w </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> dw</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    y </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> y </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> dh</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    h </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> h </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> dh</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">x</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> y</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> w</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> h</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">convert_annotation</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">xmlpath</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">xmlname</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">with</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">open</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">xmlpath</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">r</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">encoding</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">utf-8</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> in_file</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        txtname </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> xmlname</span><span style=\"color: #89DDFF\">[:-</span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">.txt</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        txtfile </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">txtpath</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> txtname</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        tree </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> ET</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">parse</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">in_file</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        root </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> tree</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">getroot</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        filename </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> root</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">find</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">filename</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        img </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">imdecode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">fromfile</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #F78C6C\">&#123;&#125;</span><span style=\"color: #C3E88D\">/</span><span style=\"color: #F78C6C\">&#123;&#125;</span><span style=\"color: #C3E88D\">.</span><span style=\"color: #F78C6C\">&#123;&#125;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">format</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">imgpath</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> xmlname</span><span style=\"color: #89DDFF\">[:-</span><span style=\"color: #F78C6C\">4</span><span style=\"color: #89DDFF\">],</span><span style=\"color: #82AAFF\"> postfix</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> np</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">uint8</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">IMREAD_COLOR</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        h</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> w </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> img</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">shape</span><span style=\"color: #89DDFF\">[:</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        res </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> obj </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> root</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">iter</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">object</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            cls </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">find</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">name</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #F07178\">text</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> cls </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">in</span><span style=\"color: #BABED8\"> classes</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                classes</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">cls</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            cls_id </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> classes</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">index</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">cls</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            xmlbox </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">find</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">bndbox</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            b </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">float</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">xmlbox</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">find</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">xmin</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #F07178\">text</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">float</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">xmlbox</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">find</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">xmax</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #F07178\">text</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">float</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">xmlbox</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">find</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">ymin</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #F07178\">text</span><span style=\"color: #89DDFF\">),</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                 </span><span style=\"color: #FFCB6B\">float</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">xmlbox</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">find</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">ymax</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">).</span><span style=\"color: #F07178\">text</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            bb </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">convert</span><span style=\"color: #89DDFF\">((</span><span style=\"color: #82AAFF\">w</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> h</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #82AAFF\"> b</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            res</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cls_id</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">([</span><span style=\"color: #FFCB6B\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">a</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #82AAFF\"> a </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #82AAFF\"> bb</span><span style=\"color: #89DDFF\">]))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">res</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">!=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">with</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">open</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">txtfile</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">w+</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> f</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                f</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">write</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">\\n</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">res</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> __name__ </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">__main__</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    postfix </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">jpg</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    imgpath </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">xxx</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 图片存储位置</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    xmlpath </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">xxx</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># xml存储位置</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    txtpath </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">xxx</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># txt存储位置</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">exists</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">txtpath</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">makedirs</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">txtpath</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">exist_ok</span><span style=\"color: #89DDFF\">=True)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">list</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">listdir</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">xmlpath</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    error_file_list </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> len</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">list</span><span style=\"color: #89DDFF\">)):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">try</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            path </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">xmlpath</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">.xml</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">in</span><span style=\"color: #BABED8\"> path</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">or</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">.XML</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">in</span><span style=\"color: #BABED8\"> path</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #82AAFF\">convert_annotation</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">path</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&#39;file </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\"> convert success.&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&#39;file </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\"> is not xml format.&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Exception</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> e</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&#39;file </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\"> convert error.&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&#39;error message:</span><span style=\"color: #BABED8\">\\n</span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">e</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            error_file_list</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">append</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">list</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #82AAFF\">i</span><span style=\"color: #89DDFF\">])</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&#39;this file convert failure</span><span style=\"color: #BABED8\">\\n</span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">error_file_list</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&#39;Dataset Classes:</span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">classes</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&#39;</span><span style=\"color: #89DDFF\">)</span></span></code></pre></div><p>转换得到的文件要做成类似如下文件结构</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">——dataset</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">|</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">|</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">————train—————images</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">|</span><span style=\"color: #BABED8\">       </span><span style=\"color: #89DDFF\">|</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">|</span><span style=\"color: #BABED8\">       </span><span style=\"color: #FFCB6B\">——————labels</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">|</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">————test——————images</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">|</span><span style=\"color: #BABED8\">       </span><span style=\"color: #89DDFF\">|</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">|</span><span style=\"color: #BABED8\">       </span><span style=\"color: #FFCB6B\">——————labels</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">|</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">————val———————images</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">|</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">——————labels</span></span>\n<span class=\"line\"></span></code></pre></div><h2 id=\"配置数据集\"><a href=\"#配置数据集\" class=\"headerlink\" title=\"配置数据集\"></a>配置数据集</h2><p>在yolo中通过yaml文件来对数据集进行管理和读取，在训练时调用数据集就是看yaml的。</p>\n<p>一下提供一个简单的yaml文件的范例，建议把yaml文件和dataset放在同一个文件夹</p>\n<div class=\"language-yaml\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">yaml</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">path</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">F:\\AI\\Yolov8\\Project\\datasets\\number\\dataset</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">#数据集的位置</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">train</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">images/train</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># train图片的文件夹与数据集path的相对位置</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">val</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">images/val</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># val图片的文件夹与数据集path的相对位置</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F07178\">nc</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">8</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 目标检测物体类的数目 </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">names</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">1</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">2</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">3</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">4</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">5</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">6</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">7</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">8</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 物体对应的名称</span></span>\n<span class=\"line\"></span></code></pre></div><h2 id=\"YOLO模型训练\"><a href=\"#YOLO模型训练\" class=\"headerlink\" title=\"YOLO模型训练\"></a>YOLO模型训练</h2><p>通过yolo官方提供的库进行训练，选取yolov8n.pt作为预训练模型。yolov8n是规模最小的模型，之后部署在jetson nano上运行会相对比较流畅。</p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>这里提供一个训练脚本<strong>train.py</strong></p>\n</div>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> ultralytics </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> YOLO</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> osp</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">root_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dirname</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dirname</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">abspath</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">__file__</span><span style=\"color: #89DDFF\">)))</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">#&lt;-- absolute dir the script is in</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">script_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dirname</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">__file__</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">#&lt;-- absolute dir the script is in</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">save_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">root_dir</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">exports/runs/train/exp</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 数据会保存到../exports/runs/train/exp</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">not</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">exists</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">save_dir</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">makedirs</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">save_dir</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">dataset_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">root_dir</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">datasets</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 数据集存放文件夹位置</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> __name__ </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">__main__</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    model </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">YOLO</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;</span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">root_dir</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">//yolov8n.pt&quot;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 改成你的模型的存放地址</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># YOLO(&quot;model.pt&quot;)  use pre-trained model if available</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    model</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">info</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 展示模型信息</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    model</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">train</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">task</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">detect</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">data</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\"> dataset_dir </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\">\\\\</span><span style=\"color: #C3E88D\">number</span><span style=\"color: #BABED8\">\\\\</span><span style=\"color: #C3E88D\">num_detection.yaml</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">epochs</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">200</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">workers</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">save_dir</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">save_dir</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 进行模型训练</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># task      -&gt;  表示任务 detect表示做目标检测</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># data      -&gt;  表示数据集yaml文件的存放位置</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># epochs    -&gt;  表示训练的轮数</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># workers   -&gt;  表示装载时CPU的线程数</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># save_dir  -&gt;  表示训练出的模型的保存路径</span></span>\n<span class=\"line\"></span></code></pre></div><h2 id=\"模型验证\"><a href=\"#模型验证\" class=\"headerlink\" title=\"模型验证\"></a>模型验证</h2><p>训练出模型之后我们需要检验一下模型的识别效果，可以去runs里看混淆矩阵或召回率之类的，不过这不是我这篇博客的重点。</p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>我在这提供一个摄像头的验证demo</p>\n</div>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> osp</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> cv2</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> ultralytics </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> YOLO</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> cv2 </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> getTickCount</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> getTickFrequency</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 加载 YOLOv8 模型</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">script_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dirname</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">abspath</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">__file__</span><span style=\"color: #89DDFF\">))</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">#&lt;-- absolute dir the script is in</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">parent_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dirname</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">script_dir</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">grandpa_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dirname</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">parent_dir</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">model_path </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">grandpa_dir</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">runs/detect/train/weights/best.pt</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">model </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">YOLO</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;</span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #82AAFF\">model_path</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 获取摄像头内容，参数 0 表示使用默认的摄像头</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cap </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">VideoCapture</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #BABED8\"> cap</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">isOpened</span><span style=\"color: #89DDFF\">():</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    loop_start </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">getTickCount</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    success</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cap</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">read</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 读取摄像头的一帧图像</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> success</span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        results </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> model</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">predict</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">source</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">frame</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 对当前帧进行目标检测并显示结果</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    annotated_frame </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> results</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">].</span><span style=\"color: #82AAFF\">plot</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 中间放自己的显示程序</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    loop_time </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">getTickCount</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\"> loop_start</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    total_time </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> loop_time </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">getTickFrequency</span><span style=\"color: #89DDFF\">())</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    FPS </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">int</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #82AAFF\"> total_time</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 在图像左上角添加FPS文本</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    fps_text </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">f</span><span style=\"color: #C3E88D\">&quot;FPS: </span><span style=\"color: #F78C6C\">&#123;</span><span style=\"color: #BABED8\">FPS</span><span style=\"color: #C792EA\">:.2f</span><span style=\"color: #F78C6C\">&#125;</span><span style=\"color: #C3E88D\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    font </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">FONT_HERSHEY_SIMPLEX</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    font_scale </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    font_thickness </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">2</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    text_color </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">255</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 红色</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    text_position </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">10</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">30</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 左上角位置</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">putText</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">annotated_frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> fps_text</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> text_position</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> font</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> font_scale</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> text_color</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> font_thickness</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">imshow</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">img</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> annotated_frame</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 通过按下 &#39;q&#39; 键退出循环</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">waitKey</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&amp;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">0x</span><span style=\"color: #F78C6C\">FF</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">ord</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">q</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">break</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cap</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">release</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 释放摄像头资源</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cv2</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">destroyAllWindows</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 关闭OpenCV窗口</span></span></code></pre></div><h2 id=\"模型导出\"><a href=\"#模型导出\" class=\"headerlink\" title=\"模型导出\"></a>模型导出</h2><p>yolo是基于pytorch深度学习框架的一种视觉模型，经过训练产生的模型是后缀.pth的pytorch模型，是无法直接在端侧（非pytorch框架下）直接运行的。因此我们需要将其转换成其他类型的模型文件。一般pytorch模型都是导出成onnx模型（一种相对通用的模型）。</p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>这里提供一个pth转onnx的脚本<strong>pth_to_onnx.py</strong></p>\n</div>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> os</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">path</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">as</span><span style=\"color: #BABED8\"> osp</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> ultralytics </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> YOLO</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">script_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dirname</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">abspath</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">__file__</span><span style=\"color: #89DDFF\">))</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\">#&lt;-- absolute dir the script is in</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">parent_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dirname</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">script_dir</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">root_dir </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">dirname</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">parent_dir</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">model_path </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">root_dir</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">runs</span><span style=\"color: #BABED8\">\\\\</span><span style=\"color: #C3E88D\">detect</span><span style=\"color: #BABED8\">\\\\</span><span style=\"color: #C3E88D\">train</span><span style=\"color: #BABED8\">\\\\</span><span style=\"color: #C3E88D\">weights</span><span style=\"color: #BABED8\">\\\\</span><span style=\"color: #C3E88D\">best.pt</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #676E95; font-style: italic\"># 更改成你的模型存放位置 </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">model </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">YOLO</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">model_path</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">success </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> model</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">export</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8; font-style: italic\">format</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">onnx</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">batch</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #BABED8; font-style: italic\">save_dir</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #82AAFF\">osp</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">parent_dir</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">exports</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">))</span><span style=\"color: #676E95; font-style: italic\">#导出为onnx模型</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 静态batch 输入batch张图片作batch个的推理</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># success = model.export(format=&quot;onnx&quot;, dynamic=Ture)</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 动态batch 输入多少张图片作多少张推理 server时使用(服务器)</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 此处导出的模型为静态batch</span></span>\n<span class=\"line\"></span></code></pre></div><p>将生成的onnx模型文件上传到jetson nano上，在上位机上的模型训练工作我们就完成了。</p>\n<h2 id=\"模型部署\"><a href=\"#模型部署\" class=\"headerlink\" title=\"模型部署\"></a>模型部署</h2><p>本次模型部署使用的是<a href=\"https://github.com/shouxieai/infer\">infer</a>的模型部署框架<br>详细操作可以参考其GitHub库。</p>\n<p>首先我们在github上拉取infer的仓库</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">git</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">clone</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">https://github.com/shouxieai/infer.git</span></span></code></pre></div><details class=\"custom-details\">\n<summary>infer框架的文件结构</summary>\n<p><img src=\"https://s2.loli.net/2024/07/22/ibEgKt5rV3R8mon.png\" alt=\" 2024-07-22 183830.png\"></p>\n<p><strong>src</strong> 源文件夹，存放最终我们cmake的c++文件，进行检测的代码<br><strong>workspace</strong> 存放我们的onnx模型和提供一个节点v8格式到infer格式转换脚本v8trans.py<br><strong>workspace&#x2F;inference</strong> 存放我们的待检测的图片</p>\n</details>\n<p>需要在配置trtexec工具的环境变量</p>\n<p>打开.bashrc文件</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">nano</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">~/.bashrc</span></span></code></pre></div><p>在最后一行添加如下命令</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">export</span><span style=\"color: #BABED8\"> PATH</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #C3E88D\">/usr/src/tensorrt/bin:</span><span style=\"color: #BABED8\">$PATH</span></span></code></pre></div><p>按下<strong>ctrl+x y Enter</strong>保存并退出</p>\n<p>刷新一下环境变量</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #82AAFF\">source</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">~/.bashrc</span></span></code></pre></div><h2 id=\"onnx模型转换\"><a href=\"#onnx模型转换\" class=\"headerlink\" title=\"onnx模型转换\"></a>onnx模型转换</h2><p>将onnx模型转移到infer的workspace文件夹中，将当前工作路径移动到workspace文件夹中，执行infer提供的onnx转换到infer框架下的onnx的脚本<strong>v8trans.py</strong></p>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">python v8trans</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">py</span><span style=\"color: #BABED8\"> xx</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #F07178\">onnx</span></span></code></pre></div><p>运行后会在当前工作目录下生成一个xx.trans.onnx模型</p>\n<p>onnx模型优化<br>onnxoptimizer、onnxsim被誉为onnx的优化利器，其中onnxsim可以优化常量，onnxoptimizer可以对节点进行压缩</p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>这里提供一个onnx模型优化脚本<strong>v8onnxsim.py</strong></p>\n</div>\n<div class=\"language-python\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">python</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> onnx</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">from</span><span style=\"color: #BABED8\"> onnxsim </span><span style=\"color: #89DDFF; font-style: italic\">import</span><span style=\"color: #BABED8\"> simplify</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">onnx_model </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> onnx</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">load</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">xx.transd.onnx</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">model_simp</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> check </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">simplify</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">onnx_model</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">assert</span><span style=\"color: #BABED8\"> check</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Simplified ONNX model could not be Validated</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">onnx</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">save</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">model_simp</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #82AAFF\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">xx.transd.sim.onnx</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span></code></pre></div><p>执行完成会在当前工作目录生成一个<strong>xx.transd.sim.onnx</strong>模型，其在端侧运行的能效会高一些。</p>\n<h2 id=\"生成engine\"><a href=\"#生成engine\" class=\"headerlink\" title=\"生成engine\"></a>生成engine</h2><p>infer框架可以直接通过trtexec工具直接生成engine文件。比较简单，没有复杂的封装，适合初学者。</p>\n<p>终端使用trtexec工具直接构建engine</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">trtexec</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">--onnx=workspace/xx.transd.sim.onnx</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">--saveEngine=workspace/xx.transd.sim.engine</span></span></code></pre></div><details class=\"custom-details\">\n<summary>trtexec的扩展应用</summary>\n<p>trtexec是NVIDIA TensorRT SDK中的一个实用工具，它允许用户从命令行轻松运行和测试TensorRT引擎。trtexec命令行工具可以使用以下参数：</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">bash</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">./trtexec</span><span style=\"color: #BABED8\"> [-h] </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--uff model.uff </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">model.uff ...</span><span style=\"color: #89DDFF\">]]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--onnx model.onnx</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--model</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">model.plan</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--deploy</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">deploy.prototxt</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--output</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">output_name</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--batch</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">N</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--device</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">N</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--workspace</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">N</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--fp16</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--int8</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--calib</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">dir</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--useDLA</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">N</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--allowGPUFallback</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--iterations</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">N</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--avgRuns</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">N</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--verbose</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--nshapes</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">N</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--optShapes</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">NxN ... NxN</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--minShapes</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">NxN ... NxN</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--maxShapes</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">NxN ... NxN</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--shapeInput</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">&#123;</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\">,1,2,...&#125;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--tacticSources</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--loadEngine</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">filename</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--saveEngine</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">filename</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--plugins</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">XML file</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--dumpOutput</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">filename</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--excludePlugin</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">name</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--start</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">tag</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--streams</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">N</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--batchTile</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--engine</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">filename</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--uffInput</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">input_name,input_shape</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--uffNHWC</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--uffNCHW</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--uffHW</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">value</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--workspaceSize</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">size</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--buildOnly</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--engineFormat</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">format</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--refit</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--saveRefinedEngine</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">filename</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--calibrator</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">classname</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--detach</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--check</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--fp16Char</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--int8Calib</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">dir</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--int8IO</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--disableTensorCores</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--useSpinWait</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--shapes</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">shape</span><span style=\"color: #89DDFF\">&gt;]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">--maxBatch</span><span style=\"color: #89DDFF\">=&lt;</span><span style=\"color: #BABED8\">size</span><span style=\"color: #89DDFF\">&gt;]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">其中一些重要的参数如下：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--uff：指定输入为UFF模型，后面跟上模型文件的路径。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--onnx：指定输入为ONNX模型，后面跟上模型文件的路径。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--model：指定输入为序列化的引擎文件，后面跟上文件路径。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--deploy：指定输入为Caffe</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">deploy文件的路径。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--output：指定输出Tensor名称。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--batch：指定执行推理时每个batch的大小，默认为1。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--device：指定执行推理的设备编号，默认为0。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--workspace：指定GPU内存的最大使用量，默认为1GB。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--fp16：启用FP16精度，可提高推理性能和减少内存使用。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--int8：启用INT8精度，可进一步提高推理性能和减少内存使用。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--calib：指定INT8校准数据集的路径。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--useDLA：指定使用哪个DLA，以及在DLA上运行哪些层。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--allowGPUFallback：如果使用DLA，当某些层无法在DLA上运行时，是否允许将其回退到GPU。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--iterations：指定测试迭代次数。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--avgRuns：指定平均运行次数。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--verbose：打印更详细的输出信息。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--loadEngine：指定加载的TensorRT引擎文件，后面跟上文件路径</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">--saveEngine：指定生成的TensorRT引擎文件，后面跟上文件路径</span></span>\n<span class=\"line\"></span></code></pre></div></p>\n</details>\n<p>engine构建完成之后就可以开始运行了</p>\n<h2 id=\"开始检测\"><a href=\"#开始检测\" class=\"headerlink\" title=\"开始检测\"></a>开始检测</h2><p>实现视频流的实时目标检测，需提前给jetson nano装上USB摄像头。</p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>Makefile文件修改</p>\n</div>\n<div class=\"language-makefile\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">makefile</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">cc        </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> g++</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">nvcc      </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> /usr/local/cuda-10.2/bin/nvcc</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cpp_srcs  </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">shell</span><span style=\"color: #C3E88D\"> find src -name &quot;*.cpp&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cpp_objs  </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cpp_srcs:.cpp=.cpp.o</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cpp_objs  </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cpp_objs:src/%=objs/%</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cpp_mk\t  </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cpp_objs:.cpp.o=.cpp.mk</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cu_srcs\t  </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">shell</span><span style=\"color: #C3E88D\"> find src -name &quot;*.cu&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cu_objs   </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cu_srcs:.cu=.cu.o</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cu_objs\t  </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cu_objs:src/%=objs/%</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cu_mk\t  </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cu_objs:.cu.o=.cu.mk</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">include_paths </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> src        \\</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            /usr/include/opencv4 \\</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            /usr/include/aarch64-linux-gnu \\</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            /usr/local/cuda-10.2/include</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">library_paths </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> /usr/lib/aarch64-linux-gnu \\</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            /usr/local/cuda-10.2/lib64</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">link_librarys </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> opencv_core opencv_highgui opencv_imgproc opencv_videoio opencv_imgcodecs \\</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            nvinfer nvinfer_plugin nvonnxparser \\</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            cuda cublas cudart cudnn \\</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            stdc++ dl</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">empty\t\t  </span><span style=\"color: #89DDFF\">:=</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">export_path   </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">subst</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">empty</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">empty</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #C3E88D\">:</span><span style=\"color: #89DDFF\">,$(</span><span style=\"color: #BABED8\">library_paths</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">run_paths     </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">foreach</span><span style=\"color: #C3E88D\"> item</span><span style=\"color: #89DDFF\">,$(</span><span style=\"color: #BABED8\">library_paths</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #C3E88D\">-Wl</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #C3E88D\">-rpath=</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">item</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">include_paths </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">foreach</span><span style=\"color: #C3E88D\"> item</span><span style=\"color: #89DDFF\">,$(</span><span style=\"color: #BABED8\">include_paths</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #C3E88D\">-I</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">item</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">library_paths </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">foreach</span><span style=\"color: #C3E88D\"> item</span><span style=\"color: #89DDFF\">,$(</span><span style=\"color: #BABED8\">library_paths</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #C3E88D\">-L</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">item</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">link_librarys </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">foreach</span><span style=\"color: #C3E88D\"> item</span><span style=\"color: #89DDFF\">,$(</span><span style=\"color: #BABED8\">link_librarys</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #C3E88D\">-l</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">item</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cpp_compile_flags </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> -std=c++11 -fPIC -w -g -pthread -fopenmp -O0</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cu_compile_flags  </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> -std=c++11 -g -w -O0 -Xcompiler &quot;</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cpp_compile_flags</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">link_flags        </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> -pthread -fopenmp -Wl,-rpath=&#39;$$ORIGIN&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cpp_compile_flags </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">include_paths</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">cu_compile_flags  </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">include_paths</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">link_flags        </span><span style=\"color: #89DDFF\">+=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">library_paths</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">link_librarys</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">run_paths</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">ifneq</span><span style=\"color: #BABED8\"> (</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">MAKECMDGOALS</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> clean)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">-include</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cpp_mk</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cu_mk</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">endif</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">pro\t   </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> workspace/pro</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">expath </span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #BABED8\"> library_path.txt</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">library_path.txt</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">@echo</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">LD_LIBRARY_PATH=</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">export_path</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\">&quot;$$&quot;LD_LIBRARY_PATH &gt; $@</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">workspace/pro</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cpp_objs</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cu_objs</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        @echo Link $@</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        @mkdir -p </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">dir</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #BABED8\">$@</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        @</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cc</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> $^ -o $@ </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">link_flags</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">objs/%.cpp.o</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> src/%.cpp</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @echo Compile CXX $&lt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @mkdir -p </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">dir</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #BABED8\">$@</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cc</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> -c $&lt; -o $@ </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cpp_compile_flags</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">objs/%.cu.o</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> src/%.cu</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @echo Compile CUDA $&lt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @mkdir -p </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">dir</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #BABED8\">$@</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">nvcc</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> -c $&lt; -o $@ </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cu_compile_flags</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">objs/%.cpp.mk</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> src/%.cpp</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @echo Compile depends CXX $&lt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @mkdir -p </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">dir</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #BABED8\">$@</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">@</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cc</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">-M</span><span style=\"color: #BABED8\"> $&lt; </span><span style=\"color: #82AAFF\">-MF</span><span style=\"color: #BABED8\"> $@ </span><span style=\"color: #82AAFF\">-MT</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">@</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\">.cpp.mk=.cpp.o) </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cpp_compile_flags</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">objs/%.cu.mk</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> src/%.cu</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @echo Compile depends CUDA $&lt;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @mkdir -p </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #82AAFF\">dir</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #BABED8\">$@</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">@</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">nvcc</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">-M</span><span style=\"color: #BABED8\"> $&lt; </span><span style=\"color: #82AAFF\">-MF</span><span style=\"color: #BABED8\"> $@ </span><span style=\"color: #82AAFF\">-MT</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">@</span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\">.cu.mk=.cu.o) </span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">cu_compile_flags</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">run</span><span style=\"color: #BABED8\">   </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #BABED8\"> workspace/pro</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">          @cd workspace &amp;&amp; ./pro</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">clean</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @rm -rf objs workspace/pro</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @rm -rf library_path.txt</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    @rm -rf workspace/Result.jpg</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 导出符号，使得运行时能够链接上</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">export</span><span style=\"color: #BABED8\"> LD_LIBRARY_PATH</span><span style=\"color: #89DDFF\">:=</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">export_path</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">:</span><span style=\"color: #89DDFF\">$(</span><span style=\"color: #BABED8\">LD_LIBRARY_PATH</span><span style=\"color: #89DDFF\">)</span></span></code></pre></div><div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>源码修改，在main.cpp中进行添加与改动</p>\n</div>\n<div class=\"language-cpp\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">cpp</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C792EA\">static</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">void</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">yolo_video_demo</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">const</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">string</span><span style=\"color: #C792EA\">&amp;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8; font-style: italic\">engine_file</span><span style=\"color: #89DDFF\">)&#123;</span><span style=\"color: #676E95; font-style: italic\">\t\t// 修改1 新增函数</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #C792EA\">auto</span><span style=\"color: #BABED8\"> yolo </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">yolo</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">load</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">engine_file</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">yolo</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #FFCB6B\">Type</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #BABED8\">V8</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">yolo </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">nullptr)</span><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">  // auto remote_show = create_zmq_remote_show();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #BABED8\">Mat frame</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #BABED8\">VideoCapture </span><span style=\"color: #82AAFF\">cap</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(!</span><span style=\"color: #BABED8\">cap</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">isOpened</span><span style=\"color: #89DDFF\">())&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #82AAFF\">printf</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Engine is nullptr</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #89DDFF\">(true)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #BABED8\">cap</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">read</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">frame</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #C792EA\">auto</span><span style=\"color: #F07178\"> objs </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">yolo</span><span style=\"color: #89DDFF\">-&gt;</span><span style=\"color: #82AAFF\">forward</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">cvimg</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">frame</span><span style=\"color: #89DDFF\">));</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #C792EA\">auto</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&amp;</span><span style=\"color: #F07178\">obj </span><span style=\"color: #89DDFF\">:</span><span style=\"color: #F07178\"> objs</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #C792EA\">uint8_t</span><span style=\"color: #F07178\"> b</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> g</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> r</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #82AAFF\">tie</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">b</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> g</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> r</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">yolo</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">random_color</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">class_label</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">rectangle</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">Point</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">left</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">top</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">Point</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">right</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">bottom</span><span style=\"color: #89DDFF\">),</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                    </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">Scalar</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">b</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> g</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> r</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #C792EA\">auto</span><span style=\"color: #F07178\"> name </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">mylabels</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">class_label</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #C792EA\">auto</span><span style=\"color: #F07178\"> caption </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">format</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">%s %.2f</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> name</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">confidence</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #C792EA\">int</span><span style=\"color: #F07178\"> width </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">getTextSize</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">caption</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">nullptr).</span><span style=\"color: #BABED8\">width</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">10</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">rectangle</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">Point</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">left</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">3</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">top</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">33</span><span style=\"color: #89DDFF\">),</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">                    </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">Point</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">left</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">+</span><span style=\"color: #F07178\"> width</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">top</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">Scalar</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">b</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> g</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> r</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">putText</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">frame</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> caption</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">Point</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">left</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #BABED8\">obj</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #BABED8\">top</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">-</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #FFCB6B\">Scalar</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">all</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">),</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">16</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #82AAFF\">imshow</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">frame</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">,</span><span style=\"color: #F07178\"> frame</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">      // remote_show-&gt;post(frame);</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #C792EA\">int</span><span style=\"color: #F07178\"> key </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F07178\"> </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">waitKey</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">      </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #F07178\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #F07178\">key </span><span style=\"color: #89DDFF\">==</span><span style=\"color: #F07178\"> </span><span style=\"color: #F78C6C\">27</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">          </span><span style=\"color: #89DDFF; font-style: italic\">break</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #F07178\">  </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  cap</span><span style=\"color: #89DDFF\">.</span><span style=\"color: #82AAFF\">release</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #FFCB6B\">cv</span><span style=\"color: #89DDFF\">::</span><span style=\"color: #82AAFF\">destroyAllWindows</span><span style=\"color: #89DDFF\">();</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">int</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">main</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #676E95; font-style: italic\">\t// 修改2 调用该函数</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">  // perf();</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">  // batch_inference();</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">  // single_inference();</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #82AAFF\">yolo_video_demo</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">best.transd.sim.engine</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">  </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span></code></pre></div><h2 id=\"识别效果\"><a href=\"#识别效果\" class=\"headerlink\" title=\"识别效果\"></a>识别效果</h2><p>肉眼估计能有个10几20来帧，对于Jetson Nano这种老硬件来说已经挺不错的了。</p>\n<p><img src=\"https://s2.loli.net/2024/07/22/6AWzcJaQmxKksZy.jpg\" alt=\"d5cf2c135f9a6233b8800780387a60e.jpg\"></p>\n<details class=\"custom-details\">\n<summary>show more</summary>\n<p><img src=\"https://s2.loli.net/2024/07/22/nzqy8CXxrVwhutg.jpg\" alt=\"4e0f084d9081c47b24c74a8f6701b59.jpg\"><br><img src=\"https://s2.loli.net/2024/07/22/B6SqywFVZ7P5bnD.jpg\" alt=\"3b13e19229204d7aa4ed41eb1a32180.jpg\"><br><img src=\"https://s2.loli.net/2024/07/22/fASWsOLDJaNMyQo.jpg\" alt=\"5cf22ed78cf8ab4a09dd5aae42922fc.jpg\"></p>\n</details>\n","feature":true,"text":"前言本人在大二期间就学习了计算机视觉相关的模型搭建、训练和预测。大致了解目标检测的训练流程，却没有去实际在端设备上进行过模型的部署。在准备电赛期间，拿到 jet...","permalink":"/post/Jetson-Nano部署Yolo模型笔记","photos":[],"count_time":{"symbolsCount":"17k","symbolsTime":"15 mins."},"categories":[{"name":"Electronic","slug":"Electronic","count":6,"path":"api/categories/Electronic.json"}],"tags":[{"name":"ComputerVision","slug":"ComputerVision","count":3,"path":"api/tags/ComputerVision.json"},{"name":"jetson nano","slug":"jetson-nano","count":1,"path":"api/tags/jetson-nano.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%BD%AE\"><span class=\"toc-text\">项目前置</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E4%B8%BB%E4%BD%93\"><span class=\"toc-text\">项目主体</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B\"><span class=\"toc-text\">整体流程</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83\"><span class=\"toc-text\">模型训练</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%8B%E8%BD%BDYOLOv8\"><span class=\"toc-text\">下载YOLOv8</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E9%9B%86%E8%8E%B7%E5%8F%96\"><span class=\"toc-text\">数据集获取</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E9%9B%86%E9%87%87%E9%9B%86%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89\"><span class=\"toc-text\">数据集采集（可选）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E9%9B%86%E7%9A%84%E6%A0%87%E5%AE%9A%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89\"><span class=\"toc-text\">数据集的标定（可选）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#XML%E8%BD%ACtxt-YOLO%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F\"><span class=\"toc-text\">XML转txt(YOLO数据集格式)</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E9%9B%86\"><span class=\"toc-text\">配置数据集</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#YOLO%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83\"><span class=\"toc-text\">YOLO模型训练</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%A8%A1%E5%9E%8B%E9%AA%8C%E8%AF%81\"><span class=\"toc-text\">模型验证</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%A8%A1%E5%9E%8B%E5%AF%BC%E5%87%BA\"><span class=\"toc-text\">模型导出</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%A8%A1%E5%9E%8B%E9%83%A8%E7%BD%B2\"><span class=\"toc-text\">模型部署</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#onnx%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2\"><span class=\"toc-text\">onnx模型转换</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%94%9F%E6%88%90engine\"><span class=\"toc-text\">生成engine</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%BC%80%E5%A7%8B%E6%A3%80%E6%B5%8B\"><span class=\"toc-text\">开始检测</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AF%86%E5%88%AB%E6%95%88%E6%9E%9C\"><span class=\"toc-text\">识别效果</span></a></li></ol></li></ol>","author":{"name":"PIKO","slug":"blog-author","avatar":"https://s2.loli.net/2023/10/17/4GK2m3UkXztog9D.jpg","link":"/","description":"猫军阀军校的一个三年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"python环境搭建","uid":"5ba4847e568bd703f1becbdbb108530a","slug":"python环境搭建","date":"2024-09-09T14:55:02.000Z","updated":"2024-11-01T01:24:11.965Z","comments":true,"path":"api/articles/python环境搭建.json","keywords":null,"cover":"https://s2.loli.net/2024/09/09/6SJ9PlavDYmsKWn.jpg","text":"前言作为工科生，环境搭建是必不可少的一种能力，学会环境搭建是小白步向菜鸟的第一步。python是一门相对较新的语言，我记得在我读中学的时候这个时候python还...","permalink":"/post/python环境搭建","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"python","slug":"python","count":4,"path":"api/tags/python.json"}],"author":{"name":"PIKO","slug":"blog-author","avatar":"https://s2.loli.net/2023/10/17/4GK2m3UkXztog9D.jpg","link":"/","description":"猫军阀军校的一个三年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"}}}},"feature":true},"next_post":{"title":"三子棋对弈装置--视觉部分","uid":"46d63a6191ce7c7d772a0f14338f0d34","slug":"三子棋对弈装置-视觉部分","date":"2024-08-12T14:55:02.000Z","updated":"2024-11-01T01:27:28.589Z","comments":true,"path":"api/articles/三子棋对弈装置-视觉部分.json","keywords":null,"cover":"https://s2.loli.net/2024/07/22/9QG8dFxISpaDAq2.jpg","text":"前言本篇blog是本人在打2024电赛E题学习到的相关知识的整理，由于我们选择的方案是深度数据和RGB数据融合的方法来判断棋子的位置。不同于大多数人选择的ope...","permalink":"/post/三子棋对弈装置-视觉部分","photos":[],"count_time":{"symbolsCount":"37k","symbolsTime":"33 mins."},"categories":[{"name":"electronic","slug":"electronic","count":1,"path":"api/categories/electronic.json"}],"tags":[{"name":"ComputerVision","slug":"ComputerVision","count":3,"path":"api/tags/ComputerVision.json"}],"author":{"name":"PIKO","slug":"blog-author","avatar":"https://s2.loli.net/2023/10/17/4GK2m3UkXztog9D.jpg","link":"/","description":"猫军阀军校的一个三年级学牲。","socials":{"github":"https://github.com/Yesord","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/aoliba_believer","juejin":"","customs":{"Home":{"icon":"/img/Home.svg","link":"https://home.yesord.top"},"Academic":{"icon":"/img/Academic.svg","link":"https://academic.yesord.top"}}}},"feature":false}}